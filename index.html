<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-V7JLNB0R8H"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-V7JLNB0R8H');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Primary Meta Tags -->
    <title>Financial Calculator Suite - EMI, Loan, Savings & Tax Calculator | Free Online Tools</title>
    <meta name="title" content="Financial Calculator Suite - EMI, Loan, Savings & Tax Calculator | Free Online Tools">
    <meta name="description" content="Free online financial calculator suite for EMI calculation, loan eligibility, prepayment benefits, savings growth (FD, RD, SIP, SWP, Mutual Funds, PPF), and income tax comparison between Old and New Regime. Smart calculations for smarter financial decisions.">
    <meta name="keywords" content="EMI calculator, loan calculator, home loan EMI, car loan calculator, personal loan EMI, education loan, business loan, gold loan, savings calculator, FD calculator, RD calculator, SIP calculator, SWP calculator, mutual fund calculator, PPF calculator, income tax calculator, tax regime comparison, financial planning, loan eligibility, prepayment calculator, amortization schedule">
    <meta name="author" content="Financial Calculator Suite">
    <meta name="robots" content="index, follow">
    <meta name="language" content="English">
    <meta name="revisit-after" content="7 days">
    <meta name="generator" content="Financial Calculator Suite">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://calc-suite.com/">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://calc-suite.com/">
    <meta property="og:title" content="Financial Calculator Suite - EMI, Loan, Savings & Tax Calculator">
    <meta property="og:description" content="Free online financial calculator suite for EMI calculation, loan eligibility, savings growth, and income tax comparison. Smart calculations for smarter financial decisions.">
    <meta property="og:image" content="https://calc-suite.com/og-image.png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:image:alt" content="Financial Calculator Suite - EMI, Loan, Savings & Tax Calculator">
    <meta property="og:site_name" content="Financial Calculator Suite">
    <meta property="og:locale" content="en_US">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://calc-suite.com/">
    <meta name="twitter:title" content="Financial Calculator Suite - EMI, Loan, Savings & Tax Calculator">
    <meta name="twitter:description" content="Free online financial calculator suite for EMI calculation, loan eligibility, savings growth, and income tax comparison. Smart calculations for smarter financial decisions.">
    <meta name="twitter:image" content="https://calc-suite.com/twitter-image.png">
    <meta name="twitter:image:alt" content="Financial Calculator Suite - EMI, Loan, Savings & Tax Calculator">
    
    <!-- Additional SEO Meta Tags -->
    <meta name="theme-color" content="#6366f1">
    <meta name="msapplication-TileColor" content="#6366f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Fin Calculator">
    <meta name="application-name" content="Financial Calculator Suite">
    <meta name="format-detection" content="telephone=no">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’°</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’°</text></svg>">
    
    <!-- Preconnect for Performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <!-- Structured Data - JSON-LD -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Financial Calculator Suite",
        "description": "Free online financial calculator suite for EMI calculation, loan eligibility, prepayment benefits, savings growth, and income tax comparison.",
        "url": "https://calc-suite.com/",
        "applicationCategory": "FinanceApplication",
        "operatingSystem": "Any",
        "browserRequirements": "Requires JavaScript",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "featureList": [
            "EMI Calculator for Home, Car, Personal, Education, Business, and Gold Loans",
            "Loan Eligibility Calculator",
            "Prepayment Benefits Calculator",
            "Amortization Schedule Generator",
            "Fixed Deposit Calculator",
            "Recurring Deposit Calculator",
            "SIP Calculator",
            "SWP Calculator",
            "Mutual Fund Returns Calculator",
            "PPF Calculator",
            "Income Tax Calculator with Old and New Regime Comparison"
        ],
        "author": {
            "@type": "Organization",
            "name": "Financial Calculator Suite"
        },
        "datePublished": "2025-01-01",
        "dateModified": "2025-12-12"
    }
    </script>
    
    <!-- Structured Data - FAQPage for SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "FAQPage",
        "mainEntity": [
            {
                "@type": "Question",
                "name": "How is EMI calculated?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "EMI (Equated Monthly Installment) is calculated using the formula: EMI = [P x R x (1+R)^N] / [(1+R)^N - 1], where P is the principal loan amount, R is the monthly interest rate, and N is the number of monthly installments."
                }
            },
            {
                "@type": "Question",
                "name": "What is the difference between Old and New Tax Regime?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "The Old Tax Regime offers various deductions and exemptions like Section 80C, HRA, etc., with higher tax rates. The New Tax Regime offers lower tax rates but with fewer deductions. The choice depends on your income level and available deductions."
                }
            },
            {
                "@type": "Question",
                "name": "How does prepayment benefit work?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "Prepayment allows you to pay extra towards your loan principal, which can either reduce your EMI amount while keeping the same tenure, or reduce your loan tenure while keeping the same EMI. Both options save significant interest over the loan period."
                }
            },
            {
                "@type": "Question",
                "name": "What is SIP and how does it work?",
                "acceptedAnswer": {
                    "@type": "Answer",
                    "text": "SIP (Systematic Investment Plan) is a method of investing a fixed amount regularly in mutual funds. It helps in averaging the purchase cost and benefits from the power of compounding over time."
                }
            }
        ]
    }
    </script>
    
    <!-- Structured Data - BreadcrumbList -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "Home",
                "item": "https://calc-suite.com/"
            },
            {
                "@type": "ListItem",
                "position": 2,
                "name": "Loan Calculator",
                "item": "https://calc-suite.com/#loan"
            },
            {
                "@type": "ListItem",
                "position": 3,
                "name": "Savings Calculator",
                "item": "https://calc-suite.com/#savings"
            },
            {
                "@type": "ListItem",
                "position": 4,
                "name": "Tax Calculator",
                "item": "https://calc-suite.com/#tax"
            }
        ]
    }
    </script>
    <style>
        :root {
            /* Light Theme (default) */
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --bg-input: #f1f5f9;
            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --accent-glow: rgba(99, 102, 241, 0.25);
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --text-muted: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --border: rgba(148, 163, 184, 0.25);
            --gradient-1: linear-gradient(135deg, #6366f1 0%, #8b5cf6 50%, #ec4899 100%);
            --gradient-2: linear-gradient(135deg, #10b981 0%, #06b6d4 100%);
            --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08), 0 1px 3px rgba(0, 0, 0, 0.05);
            --orb-1: linear-gradient(135deg, #6366f1, #ec4899);
            --orb-2: linear-gradient(135deg, #8b5cf6, #a855f7);
            --orb-3: linear-gradient(135deg, #10b981, #6366f1);
            --orb-opacity: 0.3;
            --bg-pattern-1: rgba(99, 102, 241, 0.08);
            --bg-pattern-2: rgba(139, 92, 246, 0.06);
            --bg-pattern-3: rgba(236, 72, 153, 0.05);
        }

        /* Dark Theme */
        [data-theme="dark"] {
            --bg-primary: #0a0e17;
            --bg-secondary: #111827;
            --bg-card: #1a2234;
            --bg-input: #0d1321;
            --accent-primary: #06b6d4;
            --accent-secondary: #22d3ee;
            --accent-glow: rgba(6, 182, 212, 0.3);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --border: rgba(148, 163, 184, 0.1);
            --gradient-1: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%);
            --gradient-2: linear-gradient(135deg, #10b981 0%, #06b6d4 100%);
            --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.3), 0 1px 3px rgba(0, 0, 0, 0.2);
            --orb-1: #06b6d4;
            --orb-2: #3b82f6;
            --orb-3: #10b981;
            --orb-opacity: 0.4;
            --bg-pattern-1: rgba(6, 182, 212, 0.15);
            --bg-pattern-2: rgba(59, 130, 246, 0.1);
            --bg-pattern-3: rgba(16, 185, 129, 0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            transition: background-color 0.4s ease, color 0.4s ease;
        }

        *, *::before, *::after {
            transition: background-color 0.4s ease, border-color 0.4s ease, box-shadow 0.4s ease;
        }

        /* Animated Background */
        .bg-pattern {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
            background: 
                radial-gradient(ellipse 80% 50% at 50% -20%, var(--bg-pattern-1), transparent),
                radial-gradient(ellipse 60% 40% at 100% 100%, var(--bg-pattern-2), transparent),
                radial-gradient(ellipse 40% 30% at 0% 80%, var(--bg-pattern-3), transparent);
            transition: background 0.5s ease;
        }

        .floating-orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(120px);
            opacity: var(--orb-opacity);
            animation: float 20s ease-in-out infinite;
            pointer-events: none;
            z-index: 0;
            transition: background 0.5s ease, opacity 0.5s ease;
        }

        .orb-1 {
            width: 500px;
            height: 500px;
            background: var(--orb-1);
            top: -150px;
            right: -150px;
            animation-delay: 0s;
        }

        .orb-2 {
            width: 400px;
            height: 400px;
            background: var(--orb-2);
            bottom: -100px;
            left: -100px;
            animation-delay: -7s;
        }

        .orb-3 {
            width: 300px;
            height: 300px;
            background: var(--orb-3);
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            animation-delay: -14s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) scale(1); }
            25% { transform: translate(30px, -30px) scale(1.05); }
            50% { transform: translate(-20px, 20px) scale(0.95); }
            75% { transform: translate(-30px, -20px) scale(1.02); }
        }

        /* Main Container */
        .container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 20px 40px;
        }

        /* Header */
        header {
            text-align: center;
            margin-bottom: 24px;
            animation: slideDown 0.6s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .logo {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 4px;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: var(--gradient-1);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        h1 {
            font-size: clamp(1.5rem, 4vw, 2rem);
            font-weight: 700;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: inline;
        }

        .tagline {
            color: var(--text-muted);
            font-size: 0.9rem;
            margin-top: 4px;
            font-weight: 300;
        }

        /* Theme Toggle */
        .theme-toggle-wrapper {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--card-shadow);
        }

        .theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px var(--accent-glow);
        }

        .theme-toggle-track {
            width: 48px;
            height: 26px;
            background: var(--bg-input);
            border-radius: 13px;
            position: relative;
            transition: all 0.3s ease;
            border: 1px solid var(--border);
        }

        .theme-toggle-thumb {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: var(--gradient-1);
            border-radius: 50%;
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        [data-theme="dark"] .theme-toggle-thumb {
            left: calc(100% - 22px);
        }

        .theme-label {
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-secondary);
            min-width: 40px;
        }

        .theme-icon {
            font-size: 1.1rem;
        }

        /* Category Navigation */
        .category-nav {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-bottom: 16px;
            animation: slideUp 0.6s ease-out 0.1s both;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .category-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 16px 24px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 16px;
            color: var(--text-secondary);
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            min-width: 280px;
            box-shadow: var(--card-shadow);
        }

        .category-btn:hover {
            border-color: var(--accent-primary);
            color: var(--text-primary);
            transform: translateY(-3px);
            box-shadow: 0 12px 40px rgba(99, 102, 241, 0.15);
        }

        .category-btn.active {
            background: var(--gradient-1);
            border-color: transparent;
            color: white;
            box-shadow: 0 8px 30px var(--accent-glow);
        }

        .category-btn .category-header {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .category-icon {
            font-size: 1.3rem;
        }

        .category-name {
            font-size: 0.95rem;
            font-weight: 600;
        }

        .category-desc {
            font-size: 0.72rem;
            font-weight: 400;
            opacity: 0.8;
            line-height: 1.3;
            max-width: 240px;
        }

        .category-btn.active .category-desc {
            opacity: 0.9;
        }

        /* Sub Navigation */
        .sub-nav {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 16px;
            padding: 8px;
            background: var(--bg-card);
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .sub-nav.hidden {
            display: none;
        }

        .sub-nav-btn {
            padding: 10px 20px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--text-secondary);
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .sub-nav-btn:hover {
            background: rgba(99, 102, 241, 0.1);
            color: var(--text-primary);
        }

        .sub-nav-btn.active {
            background: rgba(99, 102, 241, 0.15);
            color: var(--accent-primary);
        }

        /* Loan Type Menu */
        .loan-type-menu {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 24px;
            padding: 16px;
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border);
        }

        .loan-type-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 20px;
            background: var(--bg-input);
            border: 2px solid transparent;
            border-radius: 12px;
            color: var(--text-secondary);
            font-family: 'Outfit', sans-serif;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
        }

        .loan-type-btn:hover {
            background: rgba(99, 102, 241, 0.08);
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }

        .loan-type-btn.active {
            background: rgba(99, 102, 241, 0.12);
            border-color: var(--accent-primary);
            color: var(--accent-secondary);
            box-shadow: 0 0 20px rgba(99, 102, 241, 0.2);
        }

        .loan-type-btn .loan-icon {
            font-size: 1.5rem;
            line-height: 1;
        }

        .loan-type-btn .loan-name {
            font-size: 0.8rem;
            white-space: nowrap;
        }

        .loan-info-bar {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-bottom: 20px;
            padding: 10px 16px;
            background: rgba(99, 102, 241, 0.08);
            border-radius: 10px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            flex-wrap: wrap;
        }

        .loan-info-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .loan-info-item strong {
            color: var(--accent-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Hide menus */
        .loan-type-menu.hidden,
        .loan-info-bar.hidden,
        .savings-type-menu.hidden,
        .savings-info-bar.hidden {
            display: none;
        }

        /* Savings Type Menu */
        .savings-type-menu {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 16px;
            padding: 16px;
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border);
        }

        .savings-type-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            padding: 12px 18px;
            background: var(--bg-input);
            border: 2px solid transparent;
            border-radius: 12px;
            color: var(--text-secondary);
            font-family: 'Outfit', sans-serif;
            font-size: 0.85rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 90px;
        }

        .savings-type-btn:hover {
            background: rgba(16, 185, 129, 0.1);
            border-color: var(--success);
            color: var(--text-primary);
        }

        .savings-type-btn.active {
            background: rgba(16, 185, 129, 0.15);
            border-color: var(--success);
            color: var(--success);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.2);
        }

        .savings-type-btn .savings-icon {
            font-size: 1.4rem;
            line-height: 1;
        }

        .savings-type-btn .savings-name {
            font-size: 0.75rem;
            white-space: nowrap;
        }

        .savings-info-bar {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-bottom: 20px;
            padding: 10px 16px;
            background: rgba(16, 185, 129, 0.08);
            border-radius: 10px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            flex-wrap: wrap;
        }

        .savings-info-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .savings-info-item strong {
            color: var(--success);
            font-family: 'JetBrains Mono', monospace;
        }

        /* Tax Calculator Styles */
        .tax-regime-toggle {
            display: flex;
            justify-content: center;
            gap: 0;
            margin-bottom: 20px;
            background: var(--bg-card);
            border-radius: 12px;
            padding: 6px;
            border: 1px solid var(--border);
        }

        .regime-btn {
            flex: 1;
            padding: 12px 24px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--text-secondary);
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .regime-btn:hover {
            color: var(--text-primary);
        }

        .regime-btn.active {
            background: var(--gradient-1);
            color: white;
            box-shadow: 0 4px 15px var(--accent-glow);
        }

        .tax-section-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--accent-secondary);
            margin: 20px 0 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }

        .tax-slab-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
            font-size: 0.85rem;
        }

        .tax-slab-table th {
            background: var(--bg-secondary);
            padding: 10px 12px;
            text-align: left;
            color: var(--text-secondary);
            font-weight: 600;
            border-bottom: 2px solid var(--accent-primary);
        }

        .tax-slab-table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--border);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
        }

        .tax-slab-table tr:hover td {
            background: rgba(99, 102, 241, 0.05);
        }

        .tax-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-top: 20px;
        }

        @media (max-width: 600px) {
            .tax-comparison {
                grid-template-columns: 1fr;
            }
        }

        .tax-regime-card {
            background: var(--bg-input);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 2px solid var(--border);
            transition: all 0.3s ease;
        }

        .tax-regime-card.recommended {
            border-color: var(--success);
            background: linear-gradient(135deg, var(--bg-input) 0%, rgba(16, 185, 129, 0.1) 100%);
        }

        .tax-regime-card .regime-label {
            font-size: 0.85rem;
            color: var(--text-muted);
            margin-bottom: 8px;
        }

        .tax-regime-card .regime-tax {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .tax-regime-card.recommended .regime-tax {
            color: var(--success);
        }

        .tax-regime-card .regime-badge {
            display: inline-block;
            margin-top: 10px;
            padding: 4px 12px;
            background: var(--success);
            color: white;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .tax-savings-banner {
            margin-top: 20px;
            padding: 16px;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.15) 0%, rgba(99, 102, 241, 0.15) 100%);
            border-radius: 12px;
            border-left: 4px solid var(--success);
            text-align: center;
        }

        .tax-savings-banner .savings-amount {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.8rem;
            font-weight: 700;
            background: var(--gradient-2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .tax-savings-banner .savings-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .deductions-group {
            background: var(--bg-input);
            border-radius: 12px;
            padding: 16px;
            margin-top: 12px;
        }

        .deduction-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border);
        }

        .deduction-row:last-child {
            border-bottom: none;
        }

        .deduction-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .deduction-input {
            width: 120px;
            padding: 8px 12px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            text-align: right;
        }

        .deduction-input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .tax-breakdown {
            margin-top: 16px;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .breakdown-item:last-child {
            border-bottom: none;
            padding-top: 14px;
            margin-top: 6px;
            border-top: 2px solid var(--accent-primary);
        }

        .breakdown-item .item-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .breakdown-item .item-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: var(--text-primary);
        }

        .breakdown-item:last-child .item-value {
            color: var(--warning);
            font-size: 1.1rem;
        }

        /* Savings Calculator Styles */
        .savings-chart {
            margin-top: 24px;
            padding: 24px;
            background: var(--bg-input);
            border-radius: 16px;
        }

        .savings-chart-title {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 16px;
            text-align: center;
        }

        .savings-bar-chart {
            display: flex;
            align-items: flex-end;
            justify-content: space-around;
            height: 200px;
            padding: 0 10px;
            gap: 8px;
        }

        .savings-bar {
            flex: 1;
            max-width: 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .bar-container {
            width: 100%;
            height: 160px;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            gap: 2px;
        }

        .bar-segment {
            width: 100%;
            border-radius: 4px 4px 0 0;
            transition: height 0.5s ease;
            min-height: 2px;
        }

        .bar-principal {
            background: var(--accent-primary);
            border-radius: 0;
        }

        .bar-interest {
            background: var(--success);
            border-radius: 4px 4px 0 0;
        }

        .bar-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-align: center;
        }

        .savings-summary-cards {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 20px;
        }

        @media (max-width: 600px) {
            .savings-summary-cards {
                grid-template-columns: 1fr;
            }
        }

        .savings-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .savings-card.highlight {
            border-color: var(--success);
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(16, 185, 129, 0.1) 100%);
        }

        .savings-card-icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .savings-card-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .savings-card-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .savings-card-value.total {
            font-size: 1.5rem;
            background: var(--gradient-2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .savings-breakdown {
            margin-top: 20px;
            padding: 16px;
            background: var(--bg-card);
            border-radius: 12px;
        }

        .breakdown-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .breakdown-row:last-child {
            border-bottom: none;
            padding-top: 14px;
            margin-top: 4px;
            border-top: 2px solid var(--accent-primary);
        }

        .breakdown-label {
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .breakdown-value {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 600;
            color: var(--text-primary);
        }

        .breakdown-row:last-child .breakdown-value {
            color: var(--success);
            font-size: 1.1rem;
        }

        /* Calculator Sections */
        .calculators {
            display: grid;
            gap: 30px;
        }

        .calculator-section {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .calculator-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.98); }
            to { opacity: 1; transform: scale(1); }
        }

        .calc-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 900px) {
            .calc-grid {
                grid-template-columns: 1fr;
            }
        }

        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 32px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(10px);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-1);
        }

        .card-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-icon {
            width: 36px;
            height: 36px;
            background: rgba(99, 102, 241, 0.12);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 24px;
        }

        label {
            display: block;
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-wrapper {
            position: relative;
        }

        .input-prefix, .input-suffix {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            pointer-events: none;
        }

        .input-prefix {
            left: 16px;
        }

        .input-suffix {
            right: 16px;
        }

        input[type="number"], input[type="text"], select {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        input[type="number"]:focus, input[type="text"]:focus, select:focus {
            outline: none;
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px var(--accent-glow);
        }

        input.has-prefix {
            padding-left: 36px;
        }

        input.has-suffix {
            padding-right: 50px;
        }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Range Slider */
        .range-wrapper {
            margin-top: 8px;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            background: var(--bg-input);
            border-radius: 3px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--gradient-1);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 10px var(--accent-glow);
            transition: transform 0.2s ease;
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.1);
        }

        .range-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 6px;
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Calculate Button */
        .btn-calculate {
            width: 100%;
            padding: 16px;
            background: var(--gradient-1);
            border: none;
            border-radius: 12px;
            color: white;
            font-family: 'Outfit', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-calculate:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px var(--accent-glow);
        }

        .btn-calculate:active {
            transform: translateY(0);
        }

        /* Results Card */
        .results-card {
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(99, 102, 241, 0.05) 100%);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
        }

        .result-item:last-child {
            border-bottom: none;
        }

        .result-label {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .result-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--accent-secondary);
        }

        .result-value.highlight {
            font-size: 1.8rem;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* EMI Breakdown Chart */
        .chart-container {
            margin-top: 24px;
            padding: 24px;
            background: var(--bg-input);
            border-radius: 16px;
        }

        .chart-title {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 16px;
            text-align: center;
        }

        .donut-chart {
            width: 180px;
            height: 180px;
            margin: 0 auto;
            position: relative;
        }

        .donut-chart svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .donut-chart circle {
            fill: none;
            stroke-width: 25;
        }

        .donut-bg {
            stroke: var(--bg-card);
        }

        .donut-principal {
            stroke: var(--accent-primary);
            stroke-linecap: round;
            transition: stroke-dasharray 1s ease;
        }

        .donut-interest {
            stroke: #f59e0b;
            stroke-linecap: round;
            transition: stroke-dasharray 1s ease;
        }

        .donut-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .donut-center .total-label {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .donut-center .total-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .chart-legend {
            display: flex;
            justify-content: center;
            gap: 24px;
            margin-top: 20px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }

        .legend-color.principal {
            background: var(--accent-primary);
        }

        .legend-color.interest {
            background: #f59e0b;
        }

        /* Eligibility Results */
        .eligibility-meter {
            margin: 24px 0;
            padding: 24px;
            background: var(--bg-input);
            border-radius: 16px;
            text-align: center;
        }

        .meter-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .meter-bar {
            height: 12px;
            background: var(--bg-card);
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .meter-fill {
            height: 100%;
            background: var(--gradient-2);
            border-radius: 6px;
            transition: width 1s ease;
        }

        .meter-value {
            margin-top: 12px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 2rem;
            font-weight: 600;
            background: var(--gradient-2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .eligibility-note {
            margin-top: 20px;
            padding: 16px;
            background: rgba(99, 102, 241, 0.1);
            border-left: 3px solid var(--accent-primary);
            border-radius: 0 8px 8px 0;
            text-align: left;
        }

        .eligibility-note p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* Status Badges */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .status-badge.success {
            background: rgba(16, 185, 129, 0.15);
            color: var(--success);
        }

        .status-badge.warning {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning);
        }

        .status-badge.error {
            background: rgba(239, 68, 68, 0.15);
            color: var(--error);
        }

        /* Footer */
        footer {
            text-align: center;
            margin-top: 60px;
            padding: 24px;
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Animations for results */
        .result-animate {
            animation: resultPop 0.5s ease-out;
        }

        @keyframes resultPop {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* Amortization Section */
        .amortization-section {
            margin-top: 30px;
        }

        .amortization-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }

        .amortization-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(99, 102, 241, 0.08) 100%);
            cursor: pointer;
            transition: background 0.3s ease;
            border-bottom: 1px solid var(--border);
        }

        .amortization-header:hover {
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(99, 102, 241, 0.12) 100%);
        }

        .amortization-header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .amortization-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .toggle-icon {
            width: 32px;
            height: 32px;
            background: var(--gradient-1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
            transition: transform 0.3s ease;
        }

        .toggle-icon.expanded {
            transform: rotate(45deg);
        }

        .amortization-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .amortization-content.expanded {
            max-height: 2000px;
        }

        .amortization-controls {
            display: flex;
            justify-content: center;
            gap: 8px;
            padding: 16px 24px;
            background: var(--bg-input);
            border-bottom: 1px solid var(--border);
        }

        .view-toggle-btn {
            padding: 10px 24px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-toggle-btn:hover {
            border-color: var(--accent-primary);
            color: var(--text-primary);
        }

        .view-toggle-btn.active {
            background: var(--gradient-1);
            border-color: transparent;
            color: white;
        }

        .amortization-table-wrapper {
            max-height: 500px;
            overflow-y: auto;
            padding: 0;
        }

        .amortization-table-wrapper::-webkit-scrollbar {
            width: 8px;
        }

        .amortization-table-wrapper::-webkit-scrollbar-track {
            background: var(--bg-input);
        }

        .amortization-table-wrapper::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 4px;
        }

        .amortization-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .amortization-table th {
            position: sticky;
            top: 0;
            background: var(--bg-secondary);
            color: var(--text-secondary);
            font-weight: 600;
            padding: 14px 16px;
            text-align: left;
            border-bottom: 2px solid var(--accent-primary);
            z-index: 1;
        }

        .amortization-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
        }

        .amortization-table tr:hover td {
            background: rgba(99, 102, 241, 0.05);
        }

        .amortization-table .year-row {
            background: rgba(99, 102, 241, 0.08);
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .amortization-table .year-row:hover {
            background: rgba(99, 102, 241, 0.12);
        }

        .amortization-table .year-row td:first-child {
            font-weight: 600;
            color: var(--accent-secondary);
        }

        .amortization-table .month-row {
            background: var(--bg-input);
        }

        .amortization-table .month-row td {
            font-size: 0.8rem;
            padding: 10px 16px 10px 32px;
            color: var(--text-secondary);
        }

        .amortization-table .month-row td:first-child {
            padding-left: 40px;
        }

        .expand-year-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            background: var(--bg-card);
            border-radius: 4px;
            margin-right: 10px;
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--accent-primary);
            transition: transform 0.2s ease, background 0.2s ease;
        }

        .expand-year-icon.expanded {
            background: var(--accent-primary);
            color: white;
            transform: rotate(90deg);
        }

        .hidden-rows {
            display: none;
        }

        .progress-bar-cell {
            position: relative;
        }

        .progress-bar {
            height: 6px;
            background: var(--bg-input);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 4px;
        }

        .progress-bar-fill {
            height: 100%;
            background: var(--gradient-2);
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        /* Prepayment Section */
        .prepayment-section {
            margin-top: 30px;
        }

        .prepayment-card {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 20px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }

        .prepayment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(16, 185, 129, 0.08) 100%);
            cursor: pointer;
            transition: background 0.3s ease;
            border-bottom: 1px solid var(--border);
        }

        .prepayment-header:hover {
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(16, 185, 129, 0.12) 100%);
        }

        .prepayment-header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .prepayment-header h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .prepayment-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease;
        }

        .prepayment-content.expanded {
            max-height: 1500px;
        }

        .prepayment-form {
            padding: 24px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 700px) {
            .prepayment-form {
                grid-template-columns: 1fr;
            }
        }

        .prepayment-option-group {
            grid-column: 1 / -1;
        }

        .prepayment-options {
            display: flex;
            gap: 12px;
            margin-top: 8px;
        }

        .prepayment-option {
            flex: 1;
            padding: 16px;
            background: var(--bg-input);
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .prepayment-option:hover {
            border-color: var(--success);
        }

        .prepayment-option.selected {
            border-color: var(--success);
            background: rgba(16, 185, 129, 0.1);
        }

        .prepayment-option input {
            display: none;
        }

        .prepayment-option .option-icon {
            font-size: 1.5rem;
            margin-bottom: 8px;
        }

        .prepayment-option .option-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .prepayment-option .option-desc {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .btn-calculate-prepayment {
            grid-column: 1 / -1;
            padding: 14px;
            background: var(--gradient-2);
            border: none;
            border-radius: 12px;
            color: white;
            font-family: 'Outfit', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-calculate-prepayment:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(16, 185, 129, 0.3);
        }

        /* Prepayment Results */
        .prepayment-results {
            padding: 24px;
            background: var(--bg-input);
            border-top: 1px solid var(--border);
            display: none;
        }

        .prepayment-results.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .prepayment-results-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .benefits-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .benefit-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--border);
        }

        .benefit-card.highlight {
            border-color: var(--success);
            background: linear-gradient(135deg, var(--bg-card) 0%, rgba(16, 185, 129, 0.1) 100%);
        }

        .benefit-icon {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }

        .benefit-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .benefit-value {
            font-family: 'JetBrains Mono', monospace;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .benefit-value.positive {
            color: var(--success);
        }

        .benefit-value.savings {
            font-size: 1.4rem;
            background: var(--gradient-2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
            font-size: 0.9rem;
        }

        .comparison-table th {
            background: var(--bg-card);
            padding: 12px 16px;
            text-align: left;
            color: var(--text-secondary);
            font-weight: 600;
            border-bottom: 2px solid var(--accent-primary);
        }

        .comparison-table td {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            font-family: 'JetBrains Mono', monospace;
        }

        .comparison-table tr:nth-child(odd) td {
            background: rgba(99, 102, 241, 0.03);
        }

        .comparison-table .old-value {
            color: var(--text-muted);
            text-decoration: line-through;
        }

        .comparison-table .new-value {
            color: var(--success);
            font-weight: 600;
        }

        .comparison-table .diff-value {
            color: var(--accent-secondary);
        }

        .savings-summary {
            margin-top: 20px;
            padding: 16px;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(99, 102, 241, 0.1) 100%);
            border-radius: 12px;
            border-left: 4px solid var(--success);
        }

        .savings-summary p {
            color: var(--text-secondary);
            line-height: 1.6;
            font-size: 0.9rem;
        }

        .savings-summary strong {
            color: var(--success);
        }

        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 20px 16px;
            }

            .card {
                padding: 24px 20px;
            }

            .tab-nav {
                flex-direction: column;
            }

            .tab-btn {
                width: 100%;
            }

            .amortization-table th,
            .amortization-table td {
                padding: 10px 8px;
                font-size: 0.75rem;
            }

            .amortization-controls {
                flex-direction: column;
            }

            .view-toggle-btn {
                width: 100%;
            }

            .loan-type-menu {
                gap: 8px;
                padding: 12px;
            }

            .loan-type-btn {
                padding: 10px 14px;
                min-width: 80px;
            }

            .loan-type-btn .loan-icon {
                font-size: 1.2rem;
            }

            .loan-type-btn .loan-name {
                font-size: 0.7rem;
            }

            .loan-info-bar,
            .savings-info-bar {
                gap: 12px;
                font-size: 0.75rem;
            }

            .savings-type-menu {
                gap: 8px;
                padding: 12px;
            }

            .savings-type-btn {
                padding: 10px 12px;
                min-width: 70px;
            }

            .savings-type-btn .savings-icon {
                font-size: 1.2rem;
            }

            .savings-type-btn .savings-name {
                font-size: 0.65rem;
            }

            .tax-regime-toggle {
                flex-direction: column;
            }

            .deduction-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 6px;
            }

            .deduction-input {
                width: 100%;
            }

            .category-nav {
                flex-direction: column;
                gap: 10px;
            }

            .category-btn {
                width: 100%;
                min-width: unset;
                padding: 12px 16px;
            }

            .category-desc {
                font-size: 0.68rem;
                max-width: 100%;
            }

            .sub-nav {
                flex-direction: column;
                gap: 6px;
            }

            .sub-nav-btn {
                width: 100%;
            }

            .prepayment-options {
                flex-direction: column;
            }

            .benefits-grid {
                grid-template-columns: 1fr 1fr;
            }

            .comparison-table {
                font-size: 0.75rem;
            }

            .comparison-table th,
            .comparison-table td {
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Fallback for non-JavaScript users -->
    <noscript>
        <div style="padding: 20px; text-align: center; background: #fef3c7; color: #92400e; font-family: sans-serif;">
            <strong>JavaScript Required:</strong> This financial calculator requires JavaScript to function. Please enable JavaScript in your browser settings to use the EMI calculator, savings calculator, and tax calculator features.
        </div>
    </noscript>
    
    <div class="bg-pattern" aria-hidden="true"></div>
    <div class="floating-orb orb-1" aria-hidden="true"></div>
    <div class="floating-orb orb-2" aria-hidden="true"></div>
    <div class="floating-orb orb-3" aria-hidden="true"></div>

    <main class="container" role="main" aria-label="Financial Calculator Suite">
        <header role="banner">
            <div class="theme-toggle-wrapper">
                <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
                    <span class="theme-icon" id="theme-icon">â˜€ï¸</span>
                    <div class="theme-toggle-track">
                        <div class="theme-toggle-thumb"></div>
                    </div>
                    <span class="theme-label" id="theme-label">Light</span>
                </button>
            </div>
            <div class="logo">
                <div class="logo-icon">ðŸ’°</div>
                <h1>Financial Calculator Suite</h1>
            </div>
            <p class="tagline">Smart calculations for smarter financial decisions</p>
        </header>

        <!-- Main Category Navigation -->
        <nav class="category-nav" aria-label="Calculator categories - Loan, Savings, and Tax calculators">
            <button class="category-btn active" onclick="switchCategory('loan')" id="category-loan" aria-pressed="true">
                <div class="category-header">
                    <span class="category-icon">ðŸ¦</span>
                    <span class="category-name">Loan Calculator</span>
                </div>
                <span class="category-desc">Calculate EMI, loan eligibility & prepayment benefits</span>
            </button>
            <button class="category-btn" onclick="switchCategory('savings')" id="category-savings">
                <div class="category-header">
                    <span class="category-icon">ðŸ’°</span>
                    <span class="category-name">Savings Calculator</span>
                </div>
                <span class="category-desc">Calculate growth & returns for FD, RD, SIP, SWP, Mutual Fund & PPF</span>
            </button>
            <button class="category-btn" onclick="switchCategory('tax')" id="category-tax">
                <div class="category-header">
                    <span class="category-icon">ðŸ“‹</span>
                    <span class="category-name">Income Tax Calculator</span>
                </div>
                <span class="category-desc">Calculate tax & compare Old Regime and New Regime</span>
            </button>
        </nav>

        <!-- Loan Type Menu -->
        <div class="loan-type-menu" id="loan-type-menu">
            <button class="loan-type-btn active" onclick="selectLoanType('home')" id="loan-home">
                <span class="loan-icon">ðŸ </span>
                <span class="loan-name">Home Loan</span>
            </button>
            <button class="loan-type-btn" onclick="selectLoanType('car')" id="loan-car">
                <span class="loan-icon">ðŸš—</span>
                <span class="loan-name">Car Loan</span>
            </button>
            <button class="loan-type-btn" onclick="selectLoanType('personal')" id="loan-personal">
                <span class="loan-icon">ðŸ’³</span>
                <span class="loan-name">Personal Loan</span>
            </button>
            <button class="loan-type-btn" onclick="selectLoanType('education')" id="loan-education">
                <span class="loan-icon">ðŸŽ“</span>
                <span class="loan-name">Education Loan</span>
            </button>
            <button class="loan-type-btn" onclick="selectLoanType('business')" id="loan-business">
                <span class="loan-icon">ðŸ’¼</span>
                <span class="loan-name">Business Loan</span>
            </button>
            <button class="loan-type-btn" onclick="selectLoanType('gold')" id="loan-gold">
                <span class="loan-icon">ðŸª™</span>
                <span class="loan-name">Gold Loan</span>
            </button>
        </div>

        <!-- Loan Info Bar -->
        <div class="loan-info-bar" id="loan-info-bar">
            <div class="loan-info-item">
                <span>ðŸ“Œ Typical Rate:</span>
                <strong id="info-rate">8.5% - 9.5%</strong>
            </div>
            <div class="loan-info-item">
                <span>â±ï¸ Max Tenure:</span>
                <strong id="info-tenure">30 Years</strong>
            </div>
            <div class="loan-info-item">
                <span>ðŸ’° Max Amount:</span>
                <strong id="info-amount">â‚¹5 Cr</strong>
            </div>
        </div>

        <!-- Loan Sub-Navigation -->
        <nav class="sub-nav" id="loan-sub-nav" aria-label="Loan calculator options - EMI Calculator and Eligibility Check">
            <button class="sub-nav-btn active" onclick="switchTab('emi')" id="tab-emi" aria-pressed="true">
                <span>ðŸ“Š EMI Calculator</span>
            </button>
            <button class="sub-nav-btn" onclick="switchTab('eligibility')" id="tab-eligibility">
                <span>âœ… Eligibility Check</span>
            </button>
        </nav>

        <div class="calculators">
            <!-- EMI Calculator -->
            <section class="calculator-section active" id="section-emi" aria-label="EMI Calculator for Home, Car, Personal, Education, Business and Gold Loans">
                <div class="calc-grid">
                    <div class="card">
                        <h2 class="card-title">
                            <span class="card-icon">ðŸ¦</span>
                            Loan Details
                        </h2>

                        <div class="form-group">
                            <label for="loan-amount">Loan Amount</label>
                            <div class="input-wrapper">
                                <span class="input-prefix">â‚¹</span>
                                <input type="number" id="loan-amount" class="has-prefix" value="5000000" min="100000" max="100000000">
                            </div>
                            <div class="range-wrapper">
                                <input type="range" id="loan-amount-range" min="100000" max="100000000" step="50000" value="5000000">
                                <div class="range-labels">
                                    <span>â‚¹1L</span>
                                    <span>â‚¹10Cr</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="interest-rate">Interest Rate (Annual)</label>
                            <div class="input-wrapper">
                                <input type="number" id="interest-rate" class="has-suffix" value="8.5" min="6.5" max="12" step="0.1">
                                <span class="input-suffix">%</span>
                            </div>
                            <div class="range-wrapper">
                                <input type="range" id="interest-rate-range" min="6.5" max="12" step="0.1" value="8.5">
                                <div class="range-labels">
                                    <span>6.5%</span>
                                    <span>12%</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="loan-tenure">Loan Tenure</label>
                            <div class="input-wrapper">
                                <input type="number" id="loan-tenure" class="has-suffix" value="20" min="1" max="30">
                                <span class="input-suffix">Years</span>
                            </div>
                            <div class="range-wrapper">
                                <input type="range" id="loan-tenure-range" min="1" max="30" step="1" value="20">
                                <div class="range-labels">
                                    <span>1 Year</span>
                                    <span>30 Years</span>
                                </div>
                            </div>
                        </div>

                        <button class="btn-calculate" onclick="calculateEMI()">
                            Calculate EMI
                        </button>
                    </div>

                    <div class="card results-card">
                        <h2 class="card-title">
                            <span class="card-icon">ðŸ“ˆ</span>
                            EMI Breakdown
                        </h2>

                        <div id="emi-results">
                            <div class="result-item">
                                <span class="result-label">Monthly EMI</span>
                                <span class="result-value highlight" id="emi-value">â‚¹8,678</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Principal Amount</span>
                                <span class="result-value" id="principal-value">â‚¹10,00,000</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Total Interest</span>
                                <span class="result-value" id="interest-value">â‚¹10,82,698</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Total Payment</span>
                                <span class="result-value" id="total-value">â‚¹20,82,698</span>
                            </div>
                        </div>

                        <div class="chart-container">
                            <p class="chart-title">Payment Distribution</p>
                            <div class="donut-chart">
                                <svg viewBox="0 0 100 100">
                                    <circle class="donut-bg" cx="50" cy="50" r="37.5"/>
                                    <circle class="donut-principal" id="chart-principal" cx="50" cy="50" r="37.5" stroke-dasharray="0 235.5"/>
                                    <circle class="donut-interest" id="chart-interest" cx="50" cy="50" r="37.5" stroke-dasharray="0 235.5"/>
                                </svg>
                                <div class="donut-center">
                                    <span class="total-label">Total</span>
                                    <span class="total-value" id="chart-total">â‚¹20.8L</span>
                                </div>
                            </div>
                            <div class="chart-legend">
                                <div class="legend-item">
                                    <span class="legend-color principal"></span>
                                    Principal
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color interest"></span>
                                    Interest
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Amortization Schedule -->
                <div class="amortization-section">
                    <div class="amortization-card">
                        <div class="amortization-header" onclick="toggleAmortization()">
                            <div class="amortization-header-left">
                                <span class="card-icon">ðŸ“‹</span>
                                <h3>Amortization Schedule</h3>
                            </div>
                            <div class="toggle-icon" id="amortization-toggle-icon">+</div>
                        </div>
                        <div class="amortization-content" id="amortization-content">
                            <div class="amortization-controls">
                                <button class="view-toggle-btn active" id="btn-yearly" onclick="switchAmortizationView('yearly')">
                                    ðŸ“… Yearly View
                                </button>
                                <button class="view-toggle-btn" id="btn-monthly" onclick="switchAmortizationView('monthly')">
                                    ðŸ“† Monthly View
                                </button>
                            </div>
                            <div class="amortization-table-wrapper">
                                <table class="amortization-table" id="amortization-table">
                                    <thead>
                                        <tr>
                                            <th>Period</th>
                                            <th>EMI</th>
                                            <th>Principal</th>
                                            <th>Interest</th>
                                            <th>Balance</th>
                                        </tr>
                                    </thead>
                                    <tbody id="amortization-tbody">
                                        <!-- Populated by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Prepayment Calculator -->
                <div class="prepayment-section">
                    <div class="prepayment-card">
                        <div class="prepayment-header" onclick="togglePrepayment()">
                            <div class="prepayment-header-left">
                                <span class="card-icon">ðŸ’¸</span>
                                <h3>Partial Payment / Prepayment</h3>
                            </div>
                            <div class="toggle-icon" id="prepayment-toggle-icon">+</div>
                        </div>
                        <div class="prepayment-content" id="prepayment-content">
                            <div class="prepayment-form">
                                <div class="form-group">
                                    <label for="prepayment-amount">Prepayment Amount</label>
                                    <div class="input-wrapper">
                                        <span class="input-prefix">â‚¹</span>
                                        <input type="number" id="prepayment-amount" class="has-prefix" value="100000" min="1000">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="prepayment-month">After EMI Month</label>
                                    <div class="input-wrapper">
                                        <input type="number" id="prepayment-month" class="has-suffix" value="12" min="1">
                                        <span class="input-suffix">Month</span>
                                    </div>
                                </div>

                                <div class="prepayment-option-group">
                                    <label>What do you want to reduce?</label>
                                    <div class="prepayment-options">
                                        <label class="prepayment-option selected" id="option-emi" onclick="selectPrepaymentOption('emi')">
                                            <input type="radio" name="prepayment-type" value="emi" checked>
                                            <div class="option-icon">ðŸ“‰</div>
                                            <div class="option-title">Reduce EMI</div>
                                            <div class="option-desc">Keep same tenure, pay less monthly</div>
                                        </label>
                                        <label class="prepayment-option" id="option-tenure" onclick="selectPrepaymentOption('tenure')">
                                            <input type="radio" name="prepayment-type" value="tenure">
                                            <div class="option-icon">â±ï¸</div>
                                            <div class="option-title">Reduce Tenure</div>
                                            <div class="option-desc">Same EMI, finish loan faster</div>
                                        </label>
                                    </div>
                                </div>

                                <button class="btn-calculate-prepayment" onclick="calculatePrepayment()">
                                    Calculate Prepayment Benefits
                                </button>
                            </div>

                            <div class="prepayment-results" id="prepayment-results">
                                <h4 class="prepayment-results-title">
                                    <span>âœ¨</span> Prepayment Benefits
                                </h4>

                                <div class="benefits-grid">
                                    <div class="benefit-card highlight">
                                        <div class="benefit-icon">ðŸ’°</div>
                                        <div class="benefit-label">Total Interest Saved</div>
                                        <div class="benefit-value savings" id="interest-saved">â‚¹0</div>
                                    </div>
                                    <div class="benefit-card">
                                        <div class="benefit-icon">ðŸ“Š</div>
                                        <div class="benefit-label">New EMI</div>
                                        <div class="benefit-value positive" id="new-emi">â‚¹0</div>
                                    </div>
                                    <div class="benefit-card">
                                        <div class="benefit-icon">ðŸ“…</div>
                                        <div class="benefit-label">New Tenure</div>
                                        <div class="benefit-value positive" id="new-tenure">0 months</div>
                                    </div>
                                    <div class="benefit-card">
                                        <div class="benefit-icon">â³</div>
                                        <div class="benefit-label">Time Saved</div>
                                        <div class="benefit-value positive" id="time-saved">0 months</div>
                                    </div>
                                </div>

                                <table class="comparison-table">
                                    <thead>
                                        <tr>
                                            <th>Parameter</th>
                                            <th>Before Prepayment</th>
                                            <th>After Prepayment</th>
                                            <th>Difference</th>
                                        </tr>
                                    </thead>
                                    <tbody id="comparison-tbody">
                                        <!-- Populated by JavaScript -->
                                    </tbody>
                                </table>

                                <div class="savings-summary" id="savings-summary">
                                    <!-- Populated by JavaScript -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Eligibility Calculator -->
            <section class="calculator-section" id="section-eligibility" aria-label="Loan Eligibility Calculator based on income and existing obligations">
                <div class="calc-grid">
                    <div class="card">
                        <h2 class="card-title">
                            <span class="card-icon">ðŸ‘¤</span>
                            Your Financial Details
                        </h2>

                        <div class="form-group">
                            <label for="monthly-income">Monthly Income (Net)</label>
                            <div class="input-wrapper">
                                <span class="input-prefix">â‚¹</span>
                                <input type="number" id="monthly-income" class="has-prefix" value="80000" min="10000" max="10000000">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="existing-emi">Existing Monthly EMIs</label>
                            <div class="input-wrapper">
                                <span class="input-prefix">â‚¹</span>
                                <input type="number" id="existing-emi" class="has-prefix" value="0" min="0" max="10000000">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="other-expenses">Other Monthly Obligations</label>
                            <div class="input-wrapper">
                                <span class="input-prefix">â‚¹</span>
                                <input type="number" id="other-expenses" class="has-prefix" value="0" min="0" max="10000000">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="elig-interest-rate">Expected Interest Rate</label>
                            <div class="input-wrapper">
                                <input type="number" id="elig-interest-rate" class="has-suffix" value="8.5" min="1" max="30" step="0.1">
                                <span class="input-suffix">%</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="elig-tenure">Preferred Loan Tenure</label>
                            <div class="input-wrapper">
                                <input type="number" id="elig-tenure" class="has-suffix" value="20" min="1" max="30">
                                <span class="input-suffix">Years</span>
                            </div>
                        </div>

                        <button class="btn-calculate" onclick="calculateEligibility()">
                            Check Eligibility
                        </button>
                    </div>

                    <div class="card results-card">
                        <h2 class="card-title">
                            <span class="card-icon">ðŸŽ¯</span>
                            Eligibility Results
                        </h2>

                        <div id="eligibility-results">
                            <div class="eligibility-meter">
                                <p class="meter-label">Maximum Loan Eligible</p>
                                <div class="meter-bar">
                                    <div class="meter-fill" id="eligibility-meter-fill" style="width: 70%"></div>
                                </div>
                                <p class="meter-value" id="max-loan-value">â‚¹34,72,000</p>
                            </div>

                            <div class="result-item">
                                <span class="result-label">Maximum EMI Affordable</span>
                                <span class="result-value" id="max-emi-value">â‚¹32,000</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">Income Available for EMI</span>
                                <span class="result-value" id="available-income">â‚¹40,000</span>
                            </div>
                            <div class="result-item">
                                <span class="result-label">FOIR Ratio</span>
                                <span class="result-value" id="foir-ratio">
                                    <span class="status-badge success">40% âœ“</span>
                                </span>
                            </div>

                            <div class="eligibility-note">
                                <p id="eligibility-note-text">
                                    <strong>ðŸ’¡ Tip:</strong> Banks typically approve loans where EMI doesn't exceed 40-50% of your net monthly income. Your current profile shows healthy loan eligibility.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Savings Calculator -->
            <section class="calculator-section" id="section-savings" aria-label="Savings Calculator for Fixed Deposit, Recurring Deposit, SIP, SWP, Mutual Funds and PPF">
                <!-- Savings Type Menu -->
                <div class="savings-type-menu" id="savings-type-menu">
                    <button class="savings-type-btn active" onclick="selectSavingsType('fd')" id="savings-fd">
                        <span class="savings-icon">ðŸ¦</span>
                        <span class="savings-name">Fixed Deposit</span>
                    </button>
                    <button class="savings-type-btn" onclick="selectSavingsType('rd')" id="savings-rd">
                        <span class="savings-icon">ðŸ“…</span>
                        <span class="savings-name">Recurring Deposit</span>
                    </button>
                    <button class="savings-type-btn" onclick="selectSavingsType('sip')" id="savings-sip">
                        <span class="savings-icon">ðŸ“ˆ</span>
                        <span class="savings-name">SIP</span>
                    </button>
                    <button class="savings-type-btn" onclick="selectSavingsType('swp')" id="savings-swp">
                        <span class="savings-icon">ðŸ’¸</span>
                        <span class="savings-name">SWP</span>
                    </button>
                    <button class="savings-type-btn" onclick="selectSavingsType('mf')" id="savings-mf">
                        <span class="savings-icon">ðŸ“Š</span>
                        <span class="savings-name">Mutual Fund</span>
                    </button>
                    <button class="savings-type-btn" onclick="selectSavingsType('ppf')" id="savings-ppf">
                        <span class="savings-icon">ðŸ›ï¸</span>
                        <span class="savings-name">PPF</span>
                    </button>
                </div>

                <!-- Savings Info Bar -->
                <div class="savings-info-bar" id="savings-info-bar">
                    <div class="savings-info-item">
                        <span>ðŸ“Œ Typical Return:</span>
                        <strong id="savings-info-rate">6% - 7.5%</strong>
                    </div>
                    <div class="savings-info-item">
                        <span>â±ï¸ Lock-in Period:</span>
                        <strong id="savings-info-lockin">7 days - 10 years</strong>
                    </div>
                    <div class="savings-info-item">
                        <span>ðŸ›¡ï¸ Risk Level:</span>
                        <strong id="savings-info-risk">Low</strong>
                    </div>
                </div>

                <div class="calc-grid">
                    <div class="card">
                        <h2 class="card-title">
                            <span class="card-icon">ðŸ’Ž</span>
                            Savings Plan
                        </h2>

                        <div class="form-group">
                            <label for="initial-deposit">Initial Deposit</label>
                            <div class="input-wrapper">
                                <span class="input-prefix">â‚¹</span>
                                <input type="number" id="initial-deposit" class="has-prefix" value="100000" min="0" max="100000000">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="monthly-deposit">Monthly Contribution</label>
                            <div class="input-wrapper">
                                <span class="input-prefix">â‚¹</span>
                                <input type="number" id="monthly-deposit" class="has-prefix" value="10000" min="0" max="10000000">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="savings-rate">Expected Return Rate (Annual)</label>
                            <div class="input-wrapper">
                                <input type="number" id="savings-rate" class="has-suffix" value="7" min="1" max="20" step="0.1">
                                <span class="input-suffix">%</span>
                            </div>
                            <div class="range-wrapper">
                                <input type="range" id="savings-rate-range" min="1" max="20" step="0.1" value="7">
                                <div class="range-labels">
                                    <span>1%</span>
                                    <span>20%</span>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="savings-duration">Investment Duration</label>
                            <div class="input-wrapper">
                                <input type="number" id="savings-duration" class="has-suffix" value="10" min="1" max="40">
                                <span class="input-suffix">Years</span>
                            </div>
                            <div class="range-wrapper">
                                <input type="range" id="savings-duration-range" min="1" max="40" step="1" value="10">
                                <div class="range-labels">
                                    <span>1 Year</span>
                                    <span>40 Years</span>
                                </div>
                            </div>
                        </div>

                        <button class="btn-calculate" onclick="calculateSavings()">
                            Calculate Returns
                        </button>
                    </div>

                    <div class="card results-card">
                        <h2 class="card-title">
                            <span class="card-icon">ðŸ“ˆ</span>
                            Growth Projection
                        </h2>

                        <div class="savings-summary-cards">
                            <div class="savings-card">
                                <div class="savings-card-icon">ðŸ’µ</div>
                                <div class="savings-card-label">Total Invested</div>
                                <div class="savings-card-value" id="total-invested">â‚¹13,00,000</div>
                            </div>
                            <div class="savings-card">
                                <div class="savings-card-icon">ðŸ“Š</div>
                                <div class="savings-card-label">Interest Earned</div>
                                <div class="savings-card-value" id="total-interest-earned">â‚¹7,43,280</div>
                            </div>
                            <div class="savings-card highlight">
                                <div class="savings-card-icon">ðŸŽ¯</div>
                                <div class="savings-card-label">Maturity Value</div>
                                <div class="savings-card-value total" id="maturity-value">â‚¹20,43,280</div>
                            </div>
                        </div>

                        <div class="savings-chart">
                            <p class="savings-chart-title">Year-wise Growth</p>
                            <div class="savings-bar-chart" id="savings-bar-chart">
                                <!-- Populated by JavaScript -->
                            </div>
                            <div class="chart-legend" style="margin-top: 16px;">
                                <div class="legend-item">
                                    <span class="legend-color principal"></span>
                                    Invested
                                </div>
                                <div class="legend-item">
                                    <span class="legend-color" style="background: var(--success);"></span>
                                    Interest
                                </div>
                            </div>
                        </div>

                        <div class="savings-breakdown">
                            <div class="breakdown-row">
                                <span class="breakdown-label">ðŸ’° Initial Deposit</span>
                                <span class="breakdown-value" id="breakdown-initial">â‚¹1,00,000</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="breakdown-label">ðŸ“… Monthly Contributions</span>
                                <span class="breakdown-value" id="breakdown-monthly">â‚¹12,00,000</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="breakdown-label">ðŸ“ˆ Interest Earned</span>
                                <span class="breakdown-value" id="breakdown-interest">â‚¹7,43,280</span>
                            </div>
                            <div class="breakdown-row">
                                <span class="breakdown-label">ðŸŽ¯ Final Amount</span>
                                <span class="breakdown-value" id="breakdown-final">â‚¹20,43,280</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Income Tax Calculator -->
            <section class="calculator-section" id="section-tax" aria-label="Income Tax Calculator with Old and New Regime comparison">
                <div class="calc-grid">
                    <div class="card">
                        <h2 class="card-title">
                            <span class="card-icon">ðŸ’¼</span>
                            Income Details
                        </h2>

                        <!-- Regime Toggle -->
                        <div class="tax-regime-toggle">
                            <button class="regime-btn active" onclick="selectTaxRegime('new')" id="regime-new">
                                ðŸ†• New Regime
                            </button>
                            <button class="regime-btn" onclick="selectTaxRegime('old')" id="regime-old">
                                ðŸ“œ Old Regime
                            </button>
                        </div>

                        <div class="form-group">
                            <label for="gross-salary">Annual Gross Salary</label>
                            <div class="input-wrapper">
                                <span class="input-prefix">â‚¹</span>
                                <input type="number" id="gross-salary" class="has-prefix" value="1200000" min="0">
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="other-income">Other Income (Interest, Rent, etc.)</label>
                            <div class="input-wrapper">
                                <span class="input-prefix">â‚¹</span>
                                <input type="number" id="other-income" class="has-prefix" value="0" min="0">
                            </div>
                        </div>

                        <!-- Deductions Section (for Old Regime) -->
                        <div id="deductions-section" style="display: none;">
                            <h3 class="tax-section-title">ðŸ“‹ Deductions (Old Regime)</h3>
                            <div class="deductions-group">
                                <div class="deduction-row">
                                    <span class="deduction-label">80C (PPF, ELSS, LIC, etc.)</span>
                                    <input type="number" class="deduction-input" id="ded-80c" value="150000" max="150000">
                                </div>
                                <div class="deduction-row">
                                    <span class="deduction-label">80D (Health Insurance)</span>
                                    <input type="number" class="deduction-input" id="ded-80d" value="25000" max="100000">
                                </div>
                                <div class="deduction-row">
                                    <span class="deduction-label">HRA Exemption</span>
                                    <input type="number" class="deduction-input" id="ded-hra" value="0">
                                </div>
                                <div class="deduction-row">
                                    <span class="deduction-label">80CCD(1B) - NPS</span>
                                    <input type="number" class="deduction-input" id="ded-nps" value="50000" max="50000">
                                </div>
                                <div class="deduction-row">
                                    <span class="deduction-label">Home Loan Interest (80EEA)</span>
                                    <input type="number" class="deduction-input" id="ded-homeloan" value="0" max="200000">
                                </div>
                                <div class="deduction-row">
                                    <span class="deduction-label">Other Deductions</span>
                                    <input type="number" class="deduction-input" id="ded-other" value="0">
                                </div>
                            </div>
                        </div>

                        <button class="btn-calculate" onclick="calculateTax()" style="margin-top: 20px;">
                            Calculate Tax
                        </button>
                    </div>

                    <div class="card results-card">
                        <h2 class="card-title">
                            <span class="card-icon">ðŸ“Š</span>
                            Tax Calculation
                        </h2>

                        <!-- Comparison Cards -->
                        <div class="tax-comparison">
                            <div class="tax-regime-card" id="old-regime-card">
                                <div class="regime-label">Old Regime Tax</div>
                                <div class="regime-tax" id="old-regime-tax">â‚¹0</div>
                            </div>
                            <div class="tax-regime-card recommended" id="new-regime-card">
                                <div class="regime-label">New Regime Tax</div>
                                <div class="regime-tax" id="new-regime-tax">â‚¹0</div>
                                <div class="regime-badge">Recommended</div>
                            </div>
                        </div>

                        <!-- Savings Banner -->
                        <div class="tax-savings-banner">
                            <div class="savings-amount" id="tax-savings">â‚¹0</div>
                            <div class="savings-label">You save by choosing <span id="better-regime">New Regime</span></div>
                        </div>

                        <!-- Tax Breakdown -->
                        <h3 class="tax-section-title">ðŸ“‹ Detailed Breakdown (<span id="selected-regime-name">New Regime</span>)</h3>
                        <div class="tax-breakdown">
                            <div class="breakdown-item">
                                <span class="item-label">Gross Income</span>
                                <span class="item-value" id="tax-gross">â‚¹12,00,000</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="item-label">Standard Deduction</span>
                                <span class="item-value" id="tax-std-ded">- â‚¹75,000</span>
                            </div>
                            <div class="breakdown-item" id="tax-deductions-row">
                                <span class="item-label">Other Deductions</span>
                                <span class="item-value" id="tax-deductions">- â‚¹0</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="item-label">Taxable Income</span>
                                <span class="item-value" id="tax-taxable">â‚¹11,25,000</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="item-label">Income Tax</span>
                                <span class="item-value" id="tax-amount">â‚¹75,000</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="item-label">Cess (4%)</span>
                                <span class="item-value" id="tax-cess">â‚¹3,000</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="item-label">Total Tax Payable</span>
                                <span class="item-value" id="tax-total">â‚¹78,000</span>
                            </div>
                        </div>

                        <!-- Tax Slabs -->
                        <h3 class="tax-section-title">ðŸ“Š Tax Slabs Applied</h3>
                        <table class="tax-slab-table">
                            <thead>
                                <tr>
                                    <th>Income Slab</th>
                                    <th>Rate</th>
                                    <th>Tax</th>
                                </tr>
                            </thead>
                            <tbody id="tax-slabs-body">
                                <!-- Populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
        </div>

        <footer>
            <p>Â© 2025 Financial Calculator Suite | Calculations are indicative and may vary based on bank policies</p>
        </footer>
    </main>

    <script>
        // Theme Toggle Functionality
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeUI(newTheme);
        }

        function updateThemeUI(theme) {
            const icon = document.getElementById('theme-icon');
            const label = document.getElementById('theme-label');
            
            if (theme === 'dark') {
                icon.textContent = 'ðŸŒ™';
                label.textContent = 'Dark';
            } else {
                icon.textContent = 'â˜€ï¸';
                label.textContent = 'Light';
            }
        }

        // Initialize theme on page load
        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeUI(savedTheme);
        }

        // Run on page load
        initTheme();

        // Loan Type Configurations
        const loanTypes = {
            home: {
                name: 'Home Loan',
                icon: 'ðŸ ',
                defaultAmount: 5000000,
                minAmount: 100000,
                maxAmount: 100000000,
                defaultRate: 8.5,
                minRate: 6.5,
                maxRate: 12,
                defaultTenure: 20,
                minTenure: 1,
                maxTenure: 30,
                infoRate: '8.5% - 9.5%',
                infoTenure: '30 Years',
                infoAmount: 'â‚¹5 Cr'
            },
            car: {
                name: 'Car Loan',
                icon: 'ðŸš—',
                defaultAmount: 800000,
                minAmount: 50000,
                maxAmount: 10000000,
                defaultRate: 9.5,
                minRate: 7.5,
                maxRate: 15,
                defaultTenure: 5,
                minTenure: 1,
                maxTenure: 7,
                infoRate: '9.5% - 12%',
                infoTenure: '7 Years',
                infoAmount: 'â‚¹1 Cr'
            },
            personal: {
                name: 'Personal Loan',
                icon: 'ðŸ’³',
                defaultAmount: 500000,
                minAmount: 10000,
                maxAmount: 5000000,
                defaultRate: 12,
                minRate: 10,
                maxRate: 24,
                defaultTenure: 3,
                minTenure: 1,
                maxTenure: 5,
                infoRate: '12% - 18%',
                infoTenure: '5 Years',
                infoAmount: 'â‚¹50 L'
            },
            education: {
                name: 'Education Loan',
                icon: 'ðŸŽ“',
                defaultAmount: 1000000,
                minAmount: 50000,
                maxAmount: 20000000,
                defaultRate: 8.5,
                minRate: 7,
                maxRate: 14,
                defaultTenure: 10,
                minTenure: 1,
                maxTenure: 15,
                infoRate: '8.5% - 11%',
                infoTenure: '15 Years',
                infoAmount: 'â‚¹2 Cr'
            },
            business: {
                name: 'Business Loan',
                icon: 'ðŸ’¼',
                defaultAmount: 2000000,
                minAmount: 100000,
                maxAmount: 50000000,
                defaultRate: 14,
                minRate: 11,
                maxRate: 24,
                defaultTenure: 5,
                minTenure: 1,
                maxTenure: 10,
                infoRate: '14% - 20%',
                infoTenure: '10 Years',
                infoAmount: 'â‚¹5 Cr'
            },
            gold: {
                name: 'Gold Loan',
                icon: 'ðŸª™',
                defaultAmount: 200000,
                minAmount: 10000,
                maxAmount: 5000000,
                defaultRate: 9,
                minRate: 7,
                maxRate: 15,
                defaultTenure: 1,
                minTenure: 1,
                maxTenure: 3,
                infoRate: '9% - 12%',
                infoTenure: '3 Years',
                infoAmount: 'â‚¹50 L'
            }
        };

        let currentLoanType = 'home';

        // Select Loan Type
        function selectLoanType(type) {
            currentLoanType = type;
            const config = loanTypes[type];

            // Update active button
            document.querySelectorAll('.loan-type-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('loan-' + type).classList.add('active');

            // Update info bar
            document.getElementById('info-rate').textContent = config.infoRate;
            document.getElementById('info-tenure').textContent = config.infoTenure;
            document.getElementById('info-amount').textContent = config.infoAmount;

            // Update EMI calculator inputs
            const amountInput = document.getElementById('loan-amount');
            const amountRange = document.getElementById('loan-amount-range');
            const rateInput = document.getElementById('interest-rate');
            const rateRange = document.getElementById('interest-rate-range');
            const tenureInput = document.getElementById('loan-tenure');
            const tenureRange = document.getElementById('loan-tenure-range');

            // Update ranges
            amountRange.min = config.minAmount;
            amountRange.max = config.maxAmount;
            rateRange.min = config.minRate;
            rateRange.max = config.maxRate;
            tenureRange.min = config.minTenure;
            tenureRange.max = config.maxTenure;

            // Update input constraints
            amountInput.min = config.minAmount;
            amountInput.max = config.maxAmount;
            rateInput.min = config.minRate;
            rateInput.max = config.maxRate;
            tenureInput.min = config.minTenure;
            tenureInput.max = config.maxTenure;

            // Set default values
            amountInput.value = config.defaultAmount;
            amountRange.value = config.defaultAmount;
            rateInput.value = config.defaultRate;
            rateRange.value = config.defaultRate;
            tenureInput.value = config.defaultTenure;
            tenureRange.value = config.defaultTenure;

            // Update range labels
            updateRangeLabels(config);

            // Recalculate EMI
            calculateEMI();

            // Update eligibility calculator defaults
            document.getElementById('elig-interest-rate').value = config.defaultRate;
            document.getElementById('elig-tenure').value = config.defaultTenure;
        }

        // Update range labels based on loan type
        function updateRangeLabels(config) {
            const formatAmount = (amt) => {
                if (amt >= 10000000) return 'â‚¹' + (amt / 10000000) + 'Cr';
                if (amt >= 100000) return 'â‚¹' + (amt / 100000) + 'L';
                if (amt >= 1000) return 'â‚¹' + (amt / 1000) + 'K';
                return 'â‚¹' + amt;
            };

            // Find and update range labels
            const amountLabels = document.querySelector('#loan-amount').closest('.form-group').querySelector('.range-labels');
            if (amountLabels) {
                amountLabels.innerHTML = `<span>${formatAmount(config.minAmount)}</span><span>${formatAmount(config.maxAmount)}</span>`;
            }

            const rateLabels = document.querySelector('#interest-rate').closest('.form-group').querySelector('.range-labels');
            if (rateLabels) {
                rateLabels.innerHTML = `<span>${config.minRate}%</span><span>${config.maxRate}%</span>`;
            }

            const tenureLabels = document.querySelector('#loan-tenure').closest('.form-group').querySelector('.range-labels');
            if (tenureLabels) {
                const tenureUnit = config.maxTenure === 1 ? 'Year' : 'Years';
                tenureLabels.innerHTML = `<span>${config.minTenure} Year</span><span>${config.maxTenure} ${tenureUnit}</span>`;
            }
        }

        // Current state
        let currentCategory = 'loan';
        let currentTab = 'emi';

        // Category Switching
        function switchCategory(category) {
            currentCategory = category;
            
            // Update category buttons
            document.querySelectorAll('.category-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('category-' + category).classList.add('active');

            // Show/hide sub navigation and loan menu
            const loanSubNav = document.getElementById('loan-sub-nav');
            const loanMenu = document.getElementById('loan-type-menu');
            const loanInfoBar = document.getElementById('loan-info-bar');

            // Get savings menu elements
            const savingsMenu = document.getElementById('savings-type-menu');
            const savingsInfoBar = document.getElementById('savings-info-bar');

            if (category === 'loan') {
                loanSubNav.classList.remove('hidden');
                loanMenu.classList.remove('hidden');
                loanInfoBar.classList.remove('hidden');
                if (savingsMenu) savingsMenu.classList.add('hidden');
                if (savingsInfoBar) savingsInfoBar.classList.add('hidden');
                // Switch to current loan tab
                switchTab(currentTab === 'savings' || currentTab === 'tax' ? 'emi' : currentTab);
            } else if (category === 'savings') {
                loanSubNav.classList.add('hidden');
                loanMenu.classList.add('hidden');
                loanInfoBar.classList.add('hidden');
                if (savingsMenu) savingsMenu.classList.remove('hidden');
                if (savingsInfoBar) savingsInfoBar.classList.remove('hidden');
                switchTab('savings');
                // Set default savings type
                selectSavingsType(currentSavingsType);
            } else if (category === 'tax') {
                loanSubNav.classList.add('hidden');
                loanMenu.classList.add('hidden');
                loanInfoBar.classList.add('hidden');
                if (savingsMenu) savingsMenu.classList.add('hidden');
                if (savingsInfoBar) savingsInfoBar.classList.add('hidden');
                switchTab('tax');
                // Calculate tax
                calculateTax();
            }
        }

        // Tab Switching (for loan sub-tabs)
        function switchTab(tab) {
            currentTab = tab;
            
            // Update sub-nav buttons
            document.querySelectorAll('.sub-nav-btn').forEach(btn => btn.classList.remove('active'));
            const tabBtn = document.getElementById('tab-' + tab);
            if (tabBtn) {
                tabBtn.classList.add('active');
            }

            // Update calculator sections
            document.querySelectorAll('.calculator-section').forEach(section => section.classList.remove('active'));
            document.getElementById('section-' + tab).classList.add('active');

            // Calculate savings when switching to savings tab
            if (tab === 'savings') {
                calculateSavings();
            }
        }

        // Sync range sliders with inputs
        function syncInputs() {
            const pairs = [
                ['loan-amount', 'loan-amount-range'],
                ['interest-rate', 'interest-rate-range'],
                ['loan-tenure', 'loan-tenure-range']
            ];

            pairs.forEach(([inputId, rangeId]) => {
                const input = document.getElementById(inputId);
                const range = document.getElementById(rangeId);

                input.addEventListener('input', () => {
                    range.value = input.value;
                    calculateEMI();
                });

                range.addEventListener('input', () => {
                    input.value = range.value;
                    calculateEMI();
                });
            });
        }

        // Format currency
        function formatCurrency(amount) {
            if (amount >= 10000000) {
                return 'â‚¹' + (amount / 10000000).toFixed(2) + 'Cr';
            } else if (amount >= 100000) {
                return 'â‚¹' + (amount / 100000).toFixed(2) + 'L';
            } else {
                return 'â‚¹' + amount.toLocaleString('en-IN');
            }
        }

        function formatFullCurrency(amount) {
            return 'â‚¹' + Math.round(amount).toLocaleString('en-IN');
        }

        // EMI Calculation
        function calculateEMI() {
            const principal = parseFloat(document.getElementById('loan-amount').value);
            const annualRate = parseFloat(document.getElementById('interest-rate').value);
            const tenureYears = parseFloat(document.getElementById('loan-tenure').value);

            const monthlyRate = annualRate / 12 / 100;
            const tenureMonths = tenureYears * 12;

            // EMI Formula: P * r * (1+r)^n / ((1+r)^n - 1)
            const emi = principal * monthlyRate * Math.pow(1 + monthlyRate, tenureMonths) / (Math.pow(1 + monthlyRate, tenureMonths) - 1);
            const totalPayment = emi * tenureMonths;
            const totalInterest = totalPayment - principal;

            // Update results with animation
            const resultsContainer = document.getElementById('emi-results');
            resultsContainer.classList.remove('result-animate');
            void resultsContainer.offsetWidth; // Trigger reflow
            resultsContainer.classList.add('result-animate');

            document.getElementById('emi-value').textContent = formatFullCurrency(emi);
            document.getElementById('principal-value').textContent = formatFullCurrency(principal);
            document.getElementById('interest-value').textContent = formatFullCurrency(totalInterest);
            document.getElementById('total-value').textContent = formatFullCurrency(totalPayment);

            // Update chart
            updateDonutChart(principal, totalInterest, totalPayment);
        }

        // Donut Chart Update
        function updateDonutChart(principal, interest, total) {
            const circumference = 2 * Math.PI * 37.5;
            const principalPercent = principal / total;
            const interestPercent = interest / total;

            const principalDash = principalPercent * circumference;
            const interestDash = interestPercent * circumference;

            document.getElementById('chart-principal').setAttribute('stroke-dasharray', `${principalDash} ${circumference}`);
            document.getElementById('chart-interest').setAttribute('stroke-dasharray', `${interestDash} ${circumference}`);
            document.getElementById('chart-interest').setAttribute('stroke-dashoffset', `-${principalDash}`);
            document.getElementById('chart-total').textContent = formatCurrency(total);
        }

        // Eligibility Calculation
        function calculateEligibility() {
            const monthlyIncome = parseFloat(document.getElementById('monthly-income').value);
            const existingEMI = parseFloat(document.getElementById('existing-emi').value) || 0;
            const otherExpenses = parseFloat(document.getElementById('other-expenses').value) || 0;
            const annualRate = parseFloat(document.getElementById('elig-interest-rate').value);
            const tenureYears = parseFloat(document.getElementById('elig-tenure').value);

            // FOIR (Fixed Obligation to Income Ratio) - typically 40-50%
            const maxFOIR = 0.5; // 50%
            const totalObligations = existingEMI + otherExpenses;
            const currentFOIR = totalObligations / monthlyIncome;
            
            // Available income for new EMI
            const availableForEMI = (monthlyIncome * maxFOIR) - totalObligations;
            const maxEMI = Math.max(0, availableForEMI);

            // Calculate max loan from max EMI
            const monthlyRate = annualRate / 12 / 100;
            const tenureMonths = tenureYears * 12;

            // Reverse EMI formula to get principal
            let maxLoan = 0;
            if (maxEMI > 0 && monthlyRate > 0) {
                maxLoan = maxEMI * (Math.pow(1 + monthlyRate, tenureMonths) - 1) / (monthlyRate * Math.pow(1 + monthlyRate, tenureMonths));
            }

            // Calculate new FOIR with max loan
            const newFOIR = ((totalObligations + maxEMI) / monthlyIncome) * 100;

            // Update results
            document.getElementById('max-loan-value').textContent = formatFullCurrency(maxLoan);
            document.getElementById('max-emi-value').textContent = formatFullCurrency(maxEMI);
            document.getElementById('available-income').textContent = formatFullCurrency(monthlyIncome * maxFOIR);

            // Update meter
            const meterPercent = Math.min((maxLoan / 10000000) * 100, 100);
            document.getElementById('eligibility-meter-fill').style.width = meterPercent + '%';

            // Update FOIR status
            const foirElement = document.getElementById('foir-ratio');
            let foirClass = 'success';
            let foirSymbol = 'âœ“';
            
            if (newFOIR > 50) {
                foirClass = 'error';
                foirSymbol = 'âœ—';
            } else if (newFOIR > 40) {
                foirClass = 'warning';
                foirSymbol = '!';
            }

            foirElement.innerHTML = `<span class="status-badge ${foirClass}">${Math.round(newFOIR)}% ${foirSymbol}</span>`;

            // Update note
            const noteElement = document.getElementById('eligibility-note-text');
            if (maxLoan <= 0) {
                noteElement.innerHTML = `<strong>âš ï¸ Alert:</strong> Your current obligations exceed the maximum allowed FOIR. Consider reducing existing EMIs or increasing income to qualify for a loan.`;
            } else if (newFOIR > 45) {
                noteElement.innerHTML = `<strong>ðŸ’¡ Tip:</strong> Your FOIR is on the higher side. Some banks may have stricter limits. Consider a longer tenure to reduce EMI, or increase down payment.`;
            } else {
                noteElement.innerHTML = `<strong>ðŸ’¡ Tip:</strong> Banks typically approve loans where EMI doesn't exceed 40-50% of your net monthly income. Your current profile shows healthy loan eligibility.`;
            }
        }

        // Amortization Schedule Data
        let amortizationData = [];
        let currentView = 'yearly';
        let isAmortizationExpanded = false;

        // Toggle Amortization Section
        function toggleAmortization() {
            isAmortizationExpanded = !isAmortizationExpanded;
            const content = document.getElementById('amortization-content');
            const icon = document.getElementById('amortization-toggle-icon');
            
            if (isAmortizationExpanded) {
                content.classList.add('expanded');
                icon.classList.add('expanded');
                icon.textContent = '+';
                generateAmortizationSchedule();
            } else {
                content.classList.remove('expanded');
                icon.classList.remove('expanded');
                icon.textContent = '+';
            }
        }

        // Switch between Yearly and Monthly View
        function switchAmortizationView(view) {
            currentView = view;
            document.getElementById('btn-yearly').classList.toggle('active', view === 'yearly');
            document.getElementById('btn-monthly').classList.toggle('active', view === 'monthly');
            renderAmortizationTable();
        }

        // Generate Amortization Schedule
        function generateAmortizationSchedule() {
            const principal = parseFloat(document.getElementById('loan-amount').value);
            const annualRate = parseFloat(document.getElementById('interest-rate').value);
            const tenureYears = parseFloat(document.getElementById('loan-tenure').value);

            const monthlyRate = annualRate / 12 / 100;
            const tenureMonths = tenureYears * 12;
            const emi = principal * monthlyRate * Math.pow(1 + monthlyRate, tenureMonths) / (Math.pow(1 + monthlyRate, tenureMonths) - 1);

            amortizationData = [];
            let balance = principal;

            for (let month = 1; month <= tenureMonths; month++) {
                const interestPayment = balance * monthlyRate;
                const principalPayment = emi - interestPayment;
                balance = balance - principalPayment;

                amortizationData.push({
                    month: month,
                    year: Math.ceil(month / 12),
                    monthInYear: ((month - 1) % 12) + 1,
                    emi: emi,
                    principal: principalPayment,
                    interest: interestPayment,
                    balance: Math.max(0, balance),
                    totalPrincipal: principal,
                    paidPercent: ((principal - Math.max(0, balance)) / principal) * 100
                });
            }

            renderAmortizationTable();
        }

        // Render Amortization Table
        function renderAmortizationTable() {
            const tbody = document.getElementById('amortization-tbody');
            tbody.innerHTML = '';

            if (currentView === 'yearly') {
                renderYearlyView(tbody);
            } else {
                renderMonthlyView(tbody);
            }
        }

        // Render Yearly View with Expandable Months
        function renderYearlyView(tbody) {
            const yearlyData = {};
            
            amortizationData.forEach(item => {
                if (!yearlyData[item.year]) {
                    yearlyData[item.year] = {
                        year: item.year,
                        emi: 0,
                        principal: 0,
                        interest: 0,
                        balance: item.balance,
                        months: []
                    };
                }
                yearlyData[item.year].emi += item.emi;
                yearlyData[item.year].principal += item.principal;
                yearlyData[item.year].interest += item.interest;
                yearlyData[item.year].balance = item.balance;
                yearlyData[item.year].paidPercent = item.paidPercent;
                yearlyData[item.year].months.push(item);
            });

            Object.values(yearlyData).forEach(year => {
                // Year row
                const yearRow = document.createElement('tr');
                yearRow.className = 'year-row';
                yearRow.setAttribute('data-year', year.year);
                yearRow.onclick = () => toggleYearMonths(year.year);
                yearRow.innerHTML = `
                    <td>
                        <span class="expand-year-icon" id="expand-icon-${year.year}">â–¶</span>
                        Year ${year.year}
                    </td>
                    <td>${formatFullCurrency(year.emi)}</td>
                    <td>${formatFullCurrency(year.principal)}</td>
                    <td>${formatFullCurrency(year.interest)}</td>
                    <td class="progress-bar-cell">
                        ${formatFullCurrency(year.balance)}
                        <div class="progress-bar">
                            <div class="progress-bar-fill" style="width: ${year.paidPercent}%"></div>
                        </div>
                    </td>
                `;
                tbody.appendChild(yearRow);

                // Month rows (hidden by default)
                year.months.forEach(month => {
                    const monthRow = document.createElement('tr');
                    monthRow.className = 'month-row hidden-rows';
                    monthRow.setAttribute('data-parent-year', year.year);
                    const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
                    monthRow.innerHTML = `
                        <td>${monthNames[month.monthInYear - 1]}</td>
                        <td>${formatFullCurrency(month.emi)}</td>
                        <td>${formatFullCurrency(month.principal)}</td>
                        <td>${formatFullCurrency(month.interest)}</td>
                        <td>${formatFullCurrency(month.balance)}</td>
                    `;
                    tbody.appendChild(monthRow);
                });
            });
        }

        // Toggle Year Months Visibility
        function toggleYearMonths(year) {
            const monthRows = document.querySelectorAll(`tr[data-parent-year="${year}"]`);
            const icon = document.getElementById(`expand-icon-${year}`);
            const isExpanded = !monthRows[0].classList.contains('hidden-rows');

            monthRows.forEach(row => {
                row.classList.toggle('hidden-rows', isExpanded);
            });

            icon.classList.toggle('expanded', !isExpanded);
        }

        // Render Monthly View
        function renderMonthlyView(tbody) {
            amortizationData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>Month ${item.month}</td>
                    <td>${formatFullCurrency(item.emi)}</td>
                    <td>${formatFullCurrency(item.principal)}</td>
                    <td>${formatFullCurrency(item.interest)}</td>
                    <td class="progress-bar-cell">
                        ${formatFullCurrency(item.balance)}
                        <div class="progress-bar">
                            <div class="progress-bar-fill" style="width: ${item.paidPercent}%"></div>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // Update EMI Calculation to also update amortization if expanded
        const originalCalculateEMI = calculateEMI;
        calculateEMI = function() {
            originalCalculateEMI();
            if (isAmortizationExpanded) {
                generateAmortizationSchedule();
            }
        };

        // Prepayment Calculator
        let isPrepaymentExpanded = false;
        let prepaymentType = 'emi';

        // Toggle Prepayment Section
        function togglePrepayment() {
            isPrepaymentExpanded = !isPrepaymentExpanded;
            const content = document.getElementById('prepayment-content');
            const icon = document.getElementById('prepayment-toggle-icon');
            
            if (isPrepaymentExpanded) {
                content.classList.add('expanded');
                icon.classList.add('expanded');
                icon.textContent = '+';
                updatePrepaymentDefaults();
            } else {
                content.classList.remove('expanded');
                icon.classList.remove('expanded');
                icon.textContent = '+';
            }
        }

        // Update prepayment defaults based on current loan
        function updatePrepaymentDefaults() {
            const principal = parseFloat(document.getElementById('loan-amount').value);
            const tenure = parseFloat(document.getElementById('loan-tenure').value);
            
            // Set default prepayment to 10% of principal or 1 lakh, whichever is lower
            const defaultPrepayment = Math.min(principal * 0.1, 100000);
            document.getElementById('prepayment-amount').value = Math.round(defaultPrepayment);
            
            // Set default month to 12 or half of tenure months
            const tenureMonths = tenure * 12;
            document.getElementById('prepayment-month').value = Math.min(12, Math.floor(tenureMonths / 2));
            document.getElementById('prepayment-month').max = tenureMonths - 1;
        }

        // Select prepayment option
        function selectPrepaymentOption(type) {
            prepaymentType = type;
            document.getElementById('option-emi').classList.toggle('selected', type === 'emi');
            document.getElementById('option-tenure').classList.toggle('selected', type === 'tenure');
        }

        // Calculate Prepayment Benefits
        function calculatePrepayment() {
            const principal = parseFloat(document.getElementById('loan-amount').value);
            const annualRate = parseFloat(document.getElementById('interest-rate').value);
            const tenureYears = parseFloat(document.getElementById('loan-tenure').value);
            const prepaymentAmount = parseFloat(document.getElementById('prepayment-amount').value);
            const prepaymentMonth = parseInt(document.getElementById('prepayment-month').value);

            const monthlyRate = annualRate / 12 / 100;
            const tenureMonths = tenureYears * 12;

            // Original EMI
            const originalEMI = principal * monthlyRate * Math.pow(1 + monthlyRate, tenureMonths) / (Math.pow(1 + monthlyRate, tenureMonths) - 1);
            
            // Calculate balance at prepayment month
            let balance = principal;
            let totalInterestBeforePrepayment = 0;
            
            for (let month = 1; month <= prepaymentMonth; month++) {
                const interestPayment = balance * monthlyRate;
                const principalPayment = originalEMI - interestPayment;
                balance -= principalPayment;
                totalInterestBeforePrepayment += interestPayment;
            }

            // Apply prepayment
            const balanceAfterPrepayment = Math.max(0, balance - prepaymentAmount);
            
            // Original total calculations
            const originalTotalPayment = originalEMI * tenureMonths;
            const originalTotalInterest = originalTotalPayment - principal;

            let newEMI, newTenureMonths, newTotalInterest, newTotalPayment;
            let interestSaved, timeSaved;

            if (prepaymentType === 'emi') {
                // Reduce EMI: Keep same remaining tenure
                const remainingMonths = tenureMonths - prepaymentMonth;
                newTenureMonths = tenureMonths;
                
                if (balanceAfterPrepayment > 0 && remainingMonths > 0) {
                    newEMI = balanceAfterPrepayment * monthlyRate * Math.pow(1 + monthlyRate, remainingMonths) / (Math.pow(1 + monthlyRate, remainingMonths) - 1);
                } else {
                    newEMI = 0;
                }
                
                timeSaved = 0;
                
                // Calculate new total interest
                const interestAfterPrepayment = (newEMI * remainingMonths) - balanceAfterPrepayment;
                newTotalInterest = totalInterestBeforePrepayment + interestAfterPrepayment;
                newTotalPayment = (originalEMI * prepaymentMonth) + prepaymentAmount + (newEMI * remainingMonths);
                
            } else {
                // Reduce Tenure: Keep same EMI
                newEMI = originalEMI;
                
                if (balanceAfterPrepayment > 0) {
                    // Calculate new tenure with same EMI
                    newTenureMonths = prepaymentMonth + Math.ceil(
                        Math.log(originalEMI / (originalEMI - balanceAfterPrepayment * monthlyRate)) / Math.log(1 + monthlyRate)
                    );
                } else {
                    newTenureMonths = prepaymentMonth;
                }
                
                timeSaved = tenureMonths - newTenureMonths;
                
                // Calculate new total interest
                let tempBalance = balanceAfterPrepayment;
                let interestAfterPrepayment = 0;
                let months = 0;
                
                while (tempBalance > 0 && months < 1000) {
                    const interestPay = tempBalance * monthlyRate;
                    const principalPay = Math.min(originalEMI - interestPay, tempBalance);
                    tempBalance -= principalPay;
                    interestAfterPrepayment += interestPay;
                    months++;
                }
                
                newTenureMonths = prepaymentMonth + months;
                newTotalInterest = totalInterestBeforePrepayment + interestAfterPrepayment;
                newTotalPayment = (originalEMI * prepaymentMonth) + prepaymentAmount + (originalEMI * months);
            }

            interestSaved = originalTotalInterest - newTotalInterest;

            // Update UI
            document.getElementById('interest-saved').textContent = formatFullCurrency(Math.max(0, interestSaved));
            document.getElementById('new-emi').textContent = formatFullCurrency(newEMI);
            document.getElementById('new-tenure').textContent = formatTenure(newTenureMonths);
            document.getElementById('time-saved').textContent = timeSaved > 0 ? formatTenure(timeSaved) : 'No change';

            // Update comparison table
            const comparisonTbody = document.getElementById('comparison-tbody');
            comparisonTbody.innerHTML = `
                <tr>
                    <td>Monthly EMI</td>
                    <td class="${prepaymentType === 'emi' ? 'old-value' : ''}">${formatFullCurrency(originalEMI)}</td>
                    <td class="new-value">${formatFullCurrency(newEMI)}</td>
                    <td class="diff-value">${prepaymentType === 'emi' ? '-' + formatFullCurrency(originalEMI - newEMI) : 'No change'}</td>
                </tr>
                <tr>
                    <td>Total Tenure</td>
                    <td class="${prepaymentType === 'tenure' ? 'old-value' : ''}">${formatTenure(tenureMonths)}</td>
                    <td class="new-value">${formatTenure(newTenureMonths)}</td>
                    <td class="diff-value">${timeSaved > 0 ? '-' + formatTenure(timeSaved) : 'No change'}</td>
                </tr>
                <tr>
                    <td>Total Interest</td>
                    <td class="old-value">${formatFullCurrency(originalTotalInterest)}</td>
                    <td class="new-value">${formatFullCurrency(newTotalInterest)}</td>
                    <td class="diff-value">-${formatFullCurrency(interestSaved)}</td>
                </tr>
                <tr>
                    <td>Total Payment</td>
                    <td class="old-value">${formatFullCurrency(originalTotalPayment)}</td>
                    <td class="new-value">${formatFullCurrency(newTotalPayment)}</td>
                    <td class="diff-value">-${formatFullCurrency(originalTotalPayment - newTotalPayment)}</td>
                </tr>
            `;

            // Update savings summary
            const savingsSummary = document.getElementById('savings-summary');
            const savingsPercent = ((interestSaved / originalTotalInterest) * 100).toFixed(1);
            
            if (prepaymentType === 'emi') {
                const emiReduction = originalEMI - newEMI;
                const emiReductionPercent = ((emiReduction / originalEMI) * 100).toFixed(1);
                savingsSummary.innerHTML = `
                    <p>
                        <strong>ðŸ’¡ Summary:</strong> By making a prepayment of <strong>${formatFullCurrency(prepaymentAmount)}</strong> after ${prepaymentMonth} months, 
                        your EMI will reduce from <strong>${formatFullCurrency(originalEMI)}</strong> to <strong>${formatFullCurrency(newEMI)}</strong> 
                        (${emiReductionPercent}% reduction). You will save <strong>${formatFullCurrency(interestSaved)}</strong> in interest (${savingsPercent}% savings).
                    </p>
                `;
            } else {
                const yearsReduced = Math.floor(timeSaved / 12);
                const monthsReduced = timeSaved % 12;
                const timeStr = yearsReduced > 0 
                    ? `${yearsReduced} year${yearsReduced > 1 ? 's' : ''} ${monthsReduced > 0 ? `and ${monthsReduced} month${monthsReduced > 1 ? 's' : ''}` : ''}`
                    : `${monthsReduced} month${monthsReduced > 1 ? 's' : ''}`;
                    
                savingsSummary.innerHTML = `
                    <p>
                        <strong>ðŸ’¡ Summary:</strong> By making a prepayment of <strong>${formatFullCurrency(prepaymentAmount)}</strong> after ${prepaymentMonth} months, 
                        you will finish your loan <strong>${timeStr}</strong> earlier! Your total interest savings will be 
                        <strong>${formatFullCurrency(interestSaved)}</strong> (${savingsPercent}% savings).
                    </p>
                `;
            }

            // Show results
            document.getElementById('prepayment-results').classList.add('show');
        }

        // Format tenure helper
        function formatTenure(months) {
            const years = Math.floor(months / 12);
            const remainingMonths = Math.round(months % 12);
            
            if (years === 0) {
                return `${remainingMonths} month${remainingMonths !== 1 ? 's' : ''}`;
            } else if (remainingMonths === 0) {
                return `${years} year${years !== 1 ? 's' : ''}`;
            } else {
                return `${years}y ${remainingMonths}m`;
            }
        }

        // Savings Type Configurations
        const savingsTypes = {
            fd: {
                name: 'Fixed Deposit',
                icon: 'ðŸ¦',
                description: 'Lump sum investment with guaranteed returns',
                defaultInitial: 100000,
                defaultMonthly: 0,
                defaultRate: 7,
                minRate: 5,
                maxRate: 9,
                defaultDuration: 5,
                minDuration: 1,
                maxDuration: 10,
                infoRate: '6% - 7.5%',
                infoLockin: '7 days - 10 years',
                infoRisk: 'Low',
                hasMonthly: false,
                compoundingNote: 'Quarterly compounding'
            },
            rd: {
                name: 'Recurring Deposit',
                icon: 'ðŸ“…',
                description: 'Regular monthly deposits with fixed returns',
                defaultInitial: 0,
                defaultMonthly: 5000,
                defaultRate: 6.5,
                minRate: 5,
                maxRate: 8,
                defaultDuration: 5,
                minDuration: 1,
                maxDuration: 10,
                infoRate: '5.5% - 7%',
                infoLockin: '6 months - 10 years',
                infoRisk: 'Low',
                hasMonthly: true,
                compoundingNote: 'Quarterly compounding'
            },
            sip: {
                name: 'SIP',
                icon: 'ðŸ“ˆ',
                description: 'Systematic Investment Plan in mutual funds',
                defaultInitial: 0,
                defaultMonthly: 10000,
                defaultRate: 12,
                minRate: 8,
                maxRate: 20,
                defaultDuration: 10,
                minDuration: 1,
                maxDuration: 30,
                infoRate: '10% - 15%',
                infoLockin: 'None (ELSS: 3 years)',
                infoRisk: 'Medium-High',
                hasMonthly: true,
                compoundingNote: 'Expected annual returns'
            },
            swp: {
                name: 'SWP',
                icon: 'ðŸ’¸',
                description: 'Systematic Withdrawal Plan for regular income',
                defaultInitial: 1000000,
                defaultMonthly: 10000,
                defaultRate: 10,
                minRate: 6,
                maxRate: 15,
                defaultDuration: 10,
                minDuration: 1,
                maxDuration: 30,
                infoRate: '8% - 12%',
                infoLockin: 'None',
                infoRisk: 'Medium',
                hasMonthly: true,
                isWithdrawal: true,
                compoundingNote: 'Monthly withdrawal from corpus'
            },
            mf: {
                name: 'Mutual Fund',
                icon: 'ðŸ“Š',
                description: 'Lump sum investment in mutual funds',
                defaultInitial: 100000,
                defaultMonthly: 0,
                defaultRate: 12,
                minRate: 8,
                maxRate: 25,
                defaultDuration: 5,
                minDuration: 1,
                maxDuration: 30,
                infoRate: '10% - 18%',
                infoLockin: 'None (ELSS: 3 years)',
                infoRisk: 'Medium-High',
                hasMonthly: false,
                compoundingNote: 'Expected annual returns'
            },
            ppf: {
                name: 'PPF',
                icon: 'ðŸ›ï¸',
                description: 'Public Provident Fund - Government backed',
                defaultInitial: 50000,
                defaultMonthly: 12500,
                defaultRate: 7.1,
                minRate: 7,
                maxRate: 8,
                defaultDuration: 15,
                minDuration: 15,
                maxDuration: 50,
                infoRate: '7.1% (Govt. fixed)',
                infoLockin: '15 years',
                infoRisk: 'Very Low',
                hasMonthly: true,
                compoundingNote: 'Annual compounding, Tax-free returns'
            }
        };

        let currentSavingsType = 'fd';

        // Select Savings Type
        function selectSavingsType(type) {
            currentSavingsType = type;
            const config = savingsTypes[type];

            // Update active button
            document.querySelectorAll('.savings-type-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('savings-' + type).classList.add('active');

            // Update info bar
            document.getElementById('savings-info-rate').textContent = config.infoRate;
            document.getElementById('savings-info-lockin').textContent = config.infoLockin;
            document.getElementById('savings-info-risk').textContent = config.infoRisk;

            // Update savings calculator inputs
            const initialInput = document.getElementById('initial-deposit');
            const monthlyInput = document.getElementById('monthly-deposit');
            const rateInput = document.getElementById('savings-rate');
            const rateRange = document.getElementById('savings-rate-range');
            const durationInput = document.getElementById('savings-duration');
            const durationRange = document.getElementById('savings-duration-range');

            // Update ranges
            rateRange.min = config.minRate;
            rateRange.max = config.maxRate;
            durationRange.min = config.minDuration;
            durationRange.max = config.maxDuration;

            // Update input constraints
            rateInput.min = config.minRate;
            rateInput.max = config.maxRate;
            durationInput.min = config.minDuration;
            durationInput.max = config.maxDuration;

            // Set default values
            initialInput.value = config.defaultInitial;
            monthlyInput.value = config.defaultMonthly;
            rateInput.value = config.defaultRate;
            rateRange.value = config.defaultRate;
            durationInput.value = config.defaultDuration;
            durationRange.value = config.defaultDuration;

            // Update labels based on type
            updateSavingsLabels(config);

            // Recalculate
            calculateSavings();
        }

        // Update labels based on savings type
        function updateSavingsLabels(config) {
            const monthlyLabel = document.querySelector('label[for="monthly-deposit"]');
            const durationLabels = document.querySelector('#savings-duration').closest('.form-group').querySelector('.range-labels');
            const rateLabels = document.querySelector('#savings-rate').closest('.form-group').querySelector('.range-labels');
            
            // Update monthly label
            if (config.isWithdrawal) {
                monthlyLabel.textContent = 'Monthly Withdrawal';
            } else {
                monthlyLabel.textContent = 'Monthly Contribution';
            }

            // Update range labels
            if (rateLabels) {
                rateLabels.innerHTML = `<span>${config.minRate}%</span><span>${config.maxRate}%</span>`;
            }
            if (durationLabels) {
                durationLabels.innerHTML = `<span>${config.minDuration} Year</span><span>${config.maxDuration} Years</span>`;
            }
        }

        // Savings Calculator
        function calculateSavings() {
            const config = savingsTypes[currentSavingsType];
            const initialDeposit = parseFloat(document.getElementById('initial-deposit').value) || 0;
            const monthlyAmount = parseFloat(document.getElementById('monthly-deposit').value) || 0;
            const annualRate = parseFloat(document.getElementById('savings-rate').value) || 0;
            const years = parseInt(document.getElementById('savings-duration').value) || 0;

            const monthlyRate = annualRate / 12 / 100;
            const totalMonths = years * 12;

            let futureValue, totalInvested, interestEarned, totalWithdrawn = 0;

            if (config && config.isWithdrawal) {
                // SWP Calculation - Systematic Withdrawal Plan
                let balance = initialDeposit;
                let totalInterest = 0;
                
                for (let month = 1; month <= totalMonths && balance > 0; month++) {
                    const interestThisMonth = balance * monthlyRate;
                    totalInterest += interestThisMonth;
                    balance = balance + interestThisMonth - monthlyAmount;
                }
                
                futureValue = Math.max(0, balance);
                totalWithdrawn = monthlyAmount * totalMonths;
                totalInvested = initialDeposit;
                interestEarned = totalInterest;
                
                // Update labels for SWP
                document.getElementById('total-invested').textContent = formatFullCurrency(initialDeposit);
                document.getElementById('total-interest-earned').textContent = formatFullCurrency(interestEarned);
                document.getElementById('maturity-value').textContent = formatFullCurrency(futureValue);
                
                // Update breakdown for SWP
                document.getElementById('breakdown-initial').textContent = formatFullCurrency(initialDeposit);
                document.getElementById('breakdown-monthly').textContent = formatFullCurrency(totalWithdrawn) + ' (withdrawn)';
                document.getElementById('breakdown-interest').textContent = formatFullCurrency(interestEarned);
                document.getElementById('breakdown-final').textContent = formatFullCurrency(futureValue);
                
                // Update card labels
                document.querySelector('#total-invested').previousElementSibling.textContent = 'Initial Corpus';
                document.querySelector('#maturity-value').previousElementSibling.textContent = 'Remaining Balance';
                
            } else {
                // Regular savings calculation (FD, RD, SIP, MF, PPF)
                // FV = P(1+r)^n + PMT * [((1+r)^n - 1) / r]
                if (monthlyRate === 0) {
                    futureValue = initialDeposit + (monthlyAmount * totalMonths);
                } else {
                    const compoundFactor = Math.pow(1 + monthlyRate, totalMonths);
                    futureValue = (initialDeposit * compoundFactor) + 
                                  (monthlyAmount * ((compoundFactor - 1) / monthlyRate));
                }

                totalInvested = initialDeposit + (monthlyAmount * totalMonths);
                interestEarned = futureValue - totalInvested;

                // Update summary cards
                document.getElementById('total-invested').textContent = formatFullCurrency(totalInvested);
                document.getElementById('total-interest-earned').textContent = formatFullCurrency(interestEarned);
                document.getElementById('maturity-value').textContent = formatFullCurrency(futureValue);

                // Update breakdown
                document.getElementById('breakdown-initial').textContent = formatFullCurrency(initialDeposit);
                document.getElementById('breakdown-monthly').textContent = formatFullCurrency(monthlyAmount * totalMonths);
                document.getElementById('breakdown-interest').textContent = formatFullCurrency(interestEarned);
                document.getElementById('breakdown-final').textContent = formatFullCurrency(futureValue);
                
                // Reset card labels
                document.querySelector('#total-invested').previousElementSibling.textContent = 'Total Invested';
                document.querySelector('#maturity-value').previousElementSibling.textContent = 'Maturity Value';
            }

            // Generate bar chart
            generateSavingsChart(initialDeposit, monthlyAmount, annualRate, years, config && config.isWithdrawal);
        }

        function generateSavingsChart(initialDeposit, monthlyAmount, annualRate, years, isWithdrawal = false) {
            const chartContainer = document.getElementById('savings-bar-chart');
            chartContainer.innerHTML = '';

            const monthlyRate = annualRate / 12 / 100;
            const yearlyData = [];

            if (isWithdrawal) {
                // SWP Chart - Show balance declining over time
                let balance = initialDeposit;
                for (let year = 1; year <= years; year++) {
                    let yearInterest = 0;
                    for (let month = 1; month <= 12 && balance > 0; month++) {
                        const interestThisMonth = balance * monthlyRate;
                        yearInterest += interestThisMonth;
                        balance = balance + interestThisMonth - monthlyAmount;
                    }
                    yearlyData.push({ 
                        year, 
                        balance: Math.max(0, balance), 
                        withdrawn: monthlyAmount * 12 * year,
                        interest: yearInterest
                    });
                }
                
                const maxValue = initialDeposit;
                const step = Math.ceil(years / 10);
                const displayData = yearlyData.filter((d, i) => (i + 1) % step === 0 || i === years - 1);

                displayData.forEach(data => {
                    const bar = document.createElement('div');
                    bar.className = 'savings-bar';
                    const balanceHeight = (data.balance / maxValue) * 140;

                    bar.innerHTML = `
                        <div class="bar-container">
                            <div class="bar-segment bar-principal" style="height: ${balanceHeight}px; border-radius: 4px 4px 0 0;" title="Balance: ${formatFullCurrency(data.balance)}"></div>
                        </div>
                        <div class="bar-label">Y${data.year}</div>
                    `;
                    chartContainer.appendChild(bar);
                });
            } else {
                // Regular savings chart
                for (let year = 1; year <= years; year++) {
                    const months = year * 12;
                    let futureValue;
                    if (monthlyRate === 0) {
                        futureValue = initialDeposit + (monthlyAmount * months);
                    } else {
                        const compoundFactor = Math.pow(1 + monthlyRate, months);
                        futureValue = (initialDeposit * compoundFactor) + 
                                      (monthlyAmount * ((compoundFactor - 1) / monthlyRate));
                    }
                    const invested = initialDeposit + (monthlyAmount * months);
                    const interest = futureValue - invested;
                    
                    yearlyData.push({ year, invested, interest, total: futureValue });
                }

                const maxTotal = Math.max(...yearlyData.map(d => d.total));
                const step = Math.ceil(years / 10);
                const displayData = yearlyData.filter((d, i) => (i + 1) % step === 0 || i === years - 1);

                displayData.forEach(data => {
                    const bar = document.createElement('div');
                    bar.className = 'savings-bar';

                    const investedHeight = (data.invested / maxTotal) * 140;
                    const interestHeight = (data.interest / maxTotal) * 140;

                    bar.innerHTML = `
                        <div class="bar-container">
                            <div class="bar-segment bar-interest" style="height: ${interestHeight}px;" title="Interest: ${formatFullCurrency(data.interest)}"></div>
                            <div class="bar-segment bar-principal" style="height: ${investedHeight}px;" title="Invested: ${formatFullCurrency(data.invested)}"></div>
                        </div>
                        <div class="bar-label">Y${data.year}</div>
                    `;
                    chartContainer.appendChild(bar);
                });
            }
        }

        // Sync savings inputs
        function syncSavingsInputs() {
            const pairs = [
                ['savings-rate', 'savings-rate-range'],
                ['savings-duration', 'savings-duration-range']
            ];

            pairs.forEach(([inputId, rangeId]) => {
                const input = document.getElementById(inputId);
                const range = document.getElementById(rangeId);

                if (input && range) {
                    input.addEventListener('input', () => {
                        range.value = input.value;
                        calculateSavings();
                    });

                    range.addEventListener('input', () => {
                        input.value = range.value;
                        calculateSavings();
                    });
                }
            });

            // Also add listeners for other savings inputs
            ['initial-deposit', 'monthly-deposit'].forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', calculateSavings);
                }
            });
        }

        // Income Tax Calculator
        let currentTaxRegime = 'new';

        // Tax Slabs FY 2024-25
        const taxSlabs = {
            new: {
                standardDeduction: 75000,
                slabs: [
                    { min: 0, max: 300000, rate: 0 },
                    { min: 300000, max: 700000, rate: 5 },
                    { min: 700000, max: 1000000, rate: 10 },
                    { min: 1000000, max: 1200000, rate: 15 },
                    { min: 1200000, max: 1500000, rate: 20 },
                    { min: 1500000, max: Infinity, rate: 30 }
                ],
                rebate87A: 25000, // Rebate under section 87A for income up to 7L
                rebateLimit: 700000
            },
            old: {
                standardDeduction: 50000,
                slabs: [
                    { min: 0, max: 250000, rate: 0 },
                    { min: 250000, max: 500000, rate: 5 },
                    { min: 500000, max: 1000000, rate: 20 },
                    { min: 1000000, max: Infinity, rate: 30 }
                ],
                rebate87A: 12500, // Rebate under section 87A for income up to 5L
                rebateLimit: 500000
            }
        };

        // Select Tax Regime
        function selectTaxRegime(regime) {
            currentTaxRegime = regime;
            
            document.querySelectorAll('.regime-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('regime-' + regime).classList.add('active');

            // Show/hide deductions section
            const deductionsSection = document.getElementById('deductions-section');
            if (regime === 'old') {
                deductionsSection.style.display = 'block';
            } else {
                deductionsSection.style.display = 'none';
            }

            calculateTax();
        }

        // Calculate Tax
        function calculateTax() {
            const grossSalary = parseFloat(document.getElementById('gross-salary').value) || 0;
            const otherIncome = parseFloat(document.getElementById('other-income').value) || 0;
            const totalGrossIncome = grossSalary + otherIncome;

            // Get deductions for old regime
            const ded80C = Math.min(parseFloat(document.getElementById('ded-80c').value) || 0, 150000);
            const ded80D = Math.min(parseFloat(document.getElementById('ded-80d').value) || 0, 100000);
            const dedHRA = parseFloat(document.getElementById('ded-hra').value) || 0;
            const dedNPS = Math.min(parseFloat(document.getElementById('ded-nps').value) || 0, 50000);
            const dedHomeLoan = Math.min(parseFloat(document.getElementById('ded-homeloan').value) || 0, 200000);
            const dedOther = parseFloat(document.getElementById('ded-other').value) || 0;
            
            const totalDeductions = ded80C + ded80D + dedHRA + dedNPS + dedHomeLoan + dedOther;

            // Calculate tax for both regimes
            const oldTaxResult = calculateTaxForRegime(totalGrossIncome, totalDeductions, 'old');
            const newTaxResult = calculateTaxForRegime(totalGrossIncome, 0, 'new');

            // Update comparison cards
            document.getElementById('old-regime-tax').textContent = formatFullCurrency(oldTaxResult.totalTax);
            document.getElementById('new-regime-tax').textContent = formatFullCurrency(newTaxResult.totalTax);

            // Determine better regime
            const oldCard = document.getElementById('old-regime-card');
            const newCard = document.getElementById('new-regime-card');
            oldCard.classList.remove('recommended');
            newCard.classList.remove('recommended');
            
            // Remove existing badges
            const existingBadges = document.querySelectorAll('.regime-badge');
            existingBadges.forEach(badge => badge.remove());

            let betterRegime, savings;
            if (oldTaxResult.totalTax <= newTaxResult.totalTax) {
                betterRegime = 'Old Regime';
                savings = newTaxResult.totalTax - oldTaxResult.totalTax;
                oldCard.classList.add('recommended');
                oldCard.innerHTML += '<div class="regime-badge">Recommended</div>';
            } else {
                betterRegime = 'New Regime';
                savings = oldTaxResult.totalTax - newTaxResult.totalTax;
                newCard.classList.add('recommended');
                newCard.innerHTML += '<div class="regime-badge">Recommended</div>';
            }

            document.getElementById('tax-savings').textContent = formatFullCurrency(savings);
            document.getElementById('better-regime').textContent = betterRegime;

            // Update breakdown for selected regime
            const selectedResult = currentTaxRegime === 'new' ? newTaxResult : oldTaxResult;
            const selectedConfig = taxSlabs[currentTaxRegime];
            
            document.getElementById('selected-regime-name').textContent = currentTaxRegime === 'new' ? 'New Regime' : 'Old Regime';
            document.getElementById('tax-gross').textContent = formatFullCurrency(totalGrossIncome);
            document.getElementById('tax-std-ded').textContent = '- ' + formatFullCurrency(selectedConfig.standardDeduction);
            
            if (currentTaxRegime === 'old') {
                document.getElementById('tax-deductions-row').style.display = 'flex';
                document.getElementById('tax-deductions').textContent = '- ' + formatFullCurrency(totalDeductions);
            } else {
                document.getElementById('tax-deductions-row').style.display = 'none';
            }
            
            document.getElementById('tax-taxable').textContent = formatFullCurrency(selectedResult.taxableIncome);
            document.getElementById('tax-amount').textContent = formatFullCurrency(selectedResult.incomeTax);
            document.getElementById('tax-cess').textContent = formatFullCurrency(selectedResult.cess);
            document.getElementById('tax-total').textContent = formatFullCurrency(selectedResult.totalTax);

            // Update tax slabs table
            updateTaxSlabsTable(selectedResult.slabBreakdown);
        }

        // Calculate tax for a specific regime
        function calculateTaxForRegime(grossIncome, deductions, regime) {
            const config = taxSlabs[regime];
            const taxableIncome = Math.max(0, grossIncome - config.standardDeduction - deductions);
            
            let incomeTax = 0;
            const slabBreakdown = [];

            for (const slab of config.slabs) {
                if (taxableIncome > slab.min) {
                    const taxableInSlab = Math.min(taxableIncome, slab.max) - slab.min;
                    const taxInSlab = (taxableInSlab * slab.rate) / 100;
                    incomeTax += taxInSlab;
                    
                    if (taxableInSlab > 0) {
                        slabBreakdown.push({
                            slab: slab.max === Infinity 
                                ? `Above â‚¹${(slab.min / 100000).toFixed(0)}L`
                                : `â‚¹${(slab.min / 100000).toFixed(0)}L - â‚¹${(slab.max / 100000).toFixed(0)}L`,
                            rate: slab.rate + '%',
                            tax: taxInSlab
                        });
                    }
                }
            }

            // Apply rebate under section 87A
            if (taxableIncome <= config.rebateLimit) {
                incomeTax = Math.max(0, incomeTax - config.rebate87A);
            }

            const cess = incomeTax * 0.04;
            const totalTax = incomeTax + cess;

            return {
                taxableIncome,
                incomeTax,
                cess,
                totalTax,
                slabBreakdown
            };
        }

        // Update tax slabs table
        function updateTaxSlabsTable(slabBreakdown) {
            const tbody = document.getElementById('tax-slabs-body');
            tbody.innerHTML = '';

            if (slabBreakdown.length === 0) {
                tbody.innerHTML = '<tr><td colspan="3" style="text-align: center; color: var(--text-muted);">No tax applicable</td></tr>';
                return;
            }

            slabBreakdown.forEach(slab => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${slab.slab}</td>
                    <td>${slab.rate}</td>
                    <td>${formatFullCurrency(slab.tax)}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Set default loan type
            selectLoanType('home');
            syncInputs();
            syncSavingsInputs();
            calculateEMI();
            calculateEligibility();
            calculateSavings();
        });
    </script>
</body>
</html>

